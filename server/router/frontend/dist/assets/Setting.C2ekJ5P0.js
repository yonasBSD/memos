import{j as e,R as ce,b as G,c as oe,M as de,d as me,e as R,f as M,C as je,g as ye,h as ee,T as Te,S as q,a as O,D as B,i as A,L as ze,k as ie}from"./mui-vendor.BwEHDYNi.js";import{s as Be,p as I,q as we,o as Pe}from"./utils-vendor.gMQV7HrB.js";import{a as f,L as Y,e as _e}from"./react-vendor.DIaRSUZC.js";import{m as E,O as $,u as C,f as w,X as _,e as y,h as v,A as L,j as F,Q as re,W as P,S as J,Y as xe,Z as V,w as S,_ as Fe,$ as se,a0 as z,U as Ie,a1 as He,b as Le,T as Ee,B as Ge,a2 as Ve,a3 as K,a4 as te,a5 as $e,a6 as Ke,a7 as qe,I as W,a8 as ve,l as Ye,y as Z,a9 as ke,aa as D,ab as Ze,ac as Qe,ad as Ne,o as Xe,n as Je,ae as es,af as ss}from"./app.BmPucvBz.js";import{E as he}from"./external-link.CnTTPCZY.js";import{L as De,A as Re}from"./LocaleSelect.qnFSfcoT.js";import"./mermaid-vendor.YaF7NM7v.js";import"./highlight-vendor.BCvQicfw.js";import"./katex-vendor.BOojJMwU.js";import"./leaflet-vendor.BDS7nALv.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=E("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=E("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=E("Clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=E("Cog",[["path",{d:"M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z",key:"sobvz5"}],["path",{d:"M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",key:"11i496"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 22v-2",key:"1osdcq"}],["path",{d:"m17 20.66-1-1.73",key:"eq3orb"}],["path",{d:"M11 10.27 7 3.34",key:"16pf9h"}],["path",{d:"m20.66 17-1.73-1",key:"sg0v6f"}],["path",{d:"m3.34 7 1.73 1",key:"1ulond"}],["path",{d:"M14 12h8",key:"4f43i9"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"m20.66 7-1.73 1",key:"1ow05n"}],["path",{d:"m3.34 17 1.73-1",key:"nuk764"}],["path",{d:"m17 3.34-1 1.73",key:"2wel8s"}],["path",{d:"m11 13.73-4 6.93",key:"794ttg"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=E("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=E("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=E("Library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=E("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),os=s=>{const{user:t,destroy:a}=s,n=C(),[o,i]=f.useState(""),[r,x]=f.useState("");f.useEffect(()=>{},[]);const c=()=>{a()},d=l=>{const h=l.target.value;i(h)},u=l=>{const h=l.target.value;x(h)},k=async()=>{if(o===""||r===""){v.error(n("message.fill-all"));return}if(o!==r){v.error(n("message.new-password-not-match")),x("");return}try{await L.updateUser({name:t.name,password:o},["password"]),v(n("message.password-changed")),c()}catch(l){console.error(l),v.error(l.details)}};return e.jsxs("div",{className:"max-w-full shadow flex flex-col justify-start items-start bg-white dark:bg-zinc-800 dark:text-gray-300 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex flex-row justify-between items-center mb-4 gap-2 w-full",children:[e.jsxs("p",{children:[n("setting.account-section.change-password")," (",t.nickname,")"]}),e.jsx(w,{size:"sm",variant:"plain",onClick:c,children:e.jsx(_,{className:"w-5 h-auto"})})]}),e.jsxs("div",{className:"flex flex-col justify-start items-start !w-80",children:[e.jsx("p",{className:"text-sm mb-1",children:n("auth.new-password")}),e.jsx(y,{className:"w-full",type:"password",placeholder:n("auth.new-password"),value:o,onChange:d}),e.jsx("p",{className:"text-sm mb-1 mt-2",children:n("auth.repeat-new-password")}),e.jsx(y,{className:"w-full",type:"password",placeholder:n("auth.repeat-new-password"),value:r,onChange:u}),e.jsxs("div",{className:"flex flex-row justify-end items-center mt-4 w-full gap-x-2",children:[e.jsx(w,{variant:"plain",onClick:c,children:n("common.cancel")}),e.jsx(w,{color:"primary",onClick:k,children:n("common.save")})]})]})]})};function We(s){$({className:"change-member-password-dialog",dialogName:"change-member-password-dialog"},os,{user:s})}const ds=()=>{const s=C(),t=F(),[a,n]=f.useState({creatingUser:re.fromPartial({username:"",password:"",role:P.USER})}),[o,i]=f.useState([]),r=Be(o,"id");f.useEffect(()=>{x()},[]);const x=async()=>{const g=await L.fetchUsers();i(g)},c=g=>g===P.HOST?"Host":g===P.ADMIN?s("setting.member-section.admin"):s("setting.member-section.user"),d=g=>{n({...a,creatingUser:{...a.creatingUser,username:g.target.value}})},u=g=>{n({...a,creatingUser:{...a.creatingUser,password:g.target.value}})},k=g=>{n({...a,creatingUser:{...a.creatingUser,role:g.target.value}})},l=async()=>{if(a.creatingUser.username===""||a.creatingUser.password===""){v.error(s("message.fill-all"));return}try{await V.createUser({user:{username:a.creatingUser.username,password:a.creatingUser.password,role:a.creatingUser.role}})}catch(g){v.error(g.details)}await x(),n({...a,creatingUser:re.fromPartial({username:"",password:"",role:P.USER})})},h=g=>{We(g)},p=async g=>{window.confirm(s("setting.member-section.archive-warning",{username:g.nickname}))&&(await V.updateUser({user:{name:g.name,state:J.ARCHIVED},updateMask:["state"]}),x())},N=async g=>{await V.updateUser({user:{name:g.name,state:J.NORMAL},updateMask:["state"]}),x()},U=async g=>{window.confirm(s("setting.member-section.delete-warning",{username:g.nickname}))&&(await L.deleteUser(g.name),x())};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-500",children:s("setting.member-section.create-a-member")}),e.jsxs("div",{className:"w-auto flex flex-col justify-start items-start gap-2 border rounded-md py-2 px-3 dark:border-zinc-700",children:[e.jsxs("div",{className:"flex flex-col justify-start items-start gap-1",children:[e.jsx("span",{children:s("common.username")}),e.jsx(y,{type:"text",placeholder:s("common.username"),autoComplete:"off",value:a.creatingUser.username,onChange:d})]}),e.jsxs("div",{className:"flex flex-col justify-start items-start gap-1",children:[e.jsx("span",{children:s("common.password")}),e.jsx(y,{type:"password",placeholder:s("common.password"),autoComplete:"off",value:a.creatingUser.password,onChange:u})]}),e.jsxs("div",{className:"flex flex-col justify-start items-start gap-1",children:[e.jsx("span",{children:s("common.role")}),e.jsxs(ce,{orientation:"horizontal",defaultValue:P.USER,onChange:k,children:[e.jsx(G,{value:P.USER,label:s("setting.member-section.user")}),e.jsx(G,{value:P.ADMIN,label:s("setting.member-section.admin")})]})]}),e.jsx("div",{className:"mt-2",children:e.jsx(w,{color:"primary",onClick:l,children:s("common.create")})})]}),e.jsx("div",{className:"w-full flex flex-row justify-between items-center mt-6",children:e.jsx("div",{className:"title-text",children:s("setting.member-list")})}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"inline-block min-w-full align-middle border rounded-lg dark:border-zinc-600",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300 dark:divide-zinc-600",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-sm font-semibold text-left text-gray-900 dark:text-gray-400",children:[e.jsx("th",{scope:"col",className:"px-3 py-2",children:s("common.username")}),e.jsx("th",{scope:"col",className:"px-3 py-2",children:s("common.role")}),e.jsx("th",{scope:"col",className:"px-3 py-2",children:s("common.nickname")}),e.jsx("th",{scope:"col",className:"px-3 py-2",children:s("common.email")}),e.jsx("th",{scope:"col",className:"relative py-2 pl-3 pr-4"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-zinc-600",children:r.map(g=>e.jsxs("tr",{children:[e.jsxs("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-500 dark:text-gray-400",children:[g.username,e.jsx("span",{className:"ml-1 italic",children:g.state===J.ARCHIVED&&"(Archived)"})]}),e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-500 dark:text-gray-400",children:c(g.role)}),e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-500 dark:text-gray-400",children:g.nickname}),e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-500 dark:text-gray-400",children:g.email}),e.jsx("td",{className:"relative whitespace-nowrap py-2 pl-3 pr-4 text-right text-sm font-medium flex justify-end",children:(t==null?void 0:t.name)===g.name?e.jsx("span",{children:s("common.yourself")}):e.jsxs(oe,{children:[e.jsx(de,{size:"sm",children:e.jsx(xe,{className:"w-4 h-auto"})}),e.jsxs(me,{placement:"bottom-end",size:"sm",children:[e.jsx(R,{onClick:()=>h(g),children:s("setting.account-section.change-password")}),g.state===J.NORMAL?e.jsx(R,{onClick:()=>p(g),children:s("setting.member-section.archive-member")}):e.jsxs(e.Fragment,{children:[e.jsx(R,{onClick:()=>N(g),children:s("common.restore")}),e.jsx(R,{onClick:()=>U(g),children:s("setting.member-section.delete-member")})]})]})]})})]},g.name))})]})})})]})},ms=()=>{const s=C(),t=S.state.memoRelatedSetting,[a,n]=f.useState(t),[o,i]=f.useState(""),[r,x]=f.useState(""),c=l=>{const h=Fe.fromPartial({...a,...l});n(h)},d=()=>{o&&(c({reactions:we([...a.reactions,o.trim()])}),i(""))},u=()=>{r&&(c({nsfwTags:we([...a.nsfwTags,r.trim()])}),x(""))},k=async()=>{if(a.reactions.length===0){v.error("Reactions must not be empty.");return}try{await S.upsertWorkspaceSetting({name:"".concat(se).concat(z.MEMO_RELATED),memoRelatedSetting:a})}catch(l){v.error(l.details),console.error(l);return}v.success(s("message.update-succeed"))};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-500",children:s("setting.memo-related-settings.title")}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.system-section.disable-public-memos")}),e.jsx(M,{checked:a.disallowPublicVisibility,onChange:l=>c({disallowPublicVisibility:l.target.checked})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.system-section.display-with-updated-time")}),e.jsx(M,{checked:a.displayWithUpdateTime,onChange:l=>c({displayWithUpdateTime:l.target.checked})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.memo-related-settings.enable-link-preview")}),e.jsx(M,{checked:a.enableLinkPreview,onChange:l=>c({enableLinkPreview:l.target.checked})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.memo-related-settings.enable-memo-comments")}),e.jsx(M,{checked:a.enableComment,onChange:l=>c({enableComment:l.target.checked})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.memo-related-settings.enable-memo-location")}),e.jsx(M,{checked:a.enableLocation,onChange:l=>c({enableLocation:l.target.checked})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.system-section.enable-double-click-to-edit")}),e.jsx(M,{checked:a.enableDoubleClickEdit,onChange:l=>c({enableDoubleClickEdit:l.target.checked})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.system-section.disable-markdown-shortcuts-in-editor")}),e.jsx(M,{checked:a.disableMarkdownShortcuts,onChange:l=>c({disableMarkdownShortcuts:l.target.checked})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.memo-related-settings.content-lenght-limit")}),e.jsx(y,{className:"w-24",type:"number",defaultValue:a.contentLengthLimit,onBlur:l=>c({contentLengthLimit:Number(l.target.value)})})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("span",{className:"truncate",children:s("setting.memo-related-settings.reactions")}),e.jsxs("div",{className:"mt-2 w-full flex flex-row flex-wrap gap-1",children:[a.reactions.map(l=>e.jsx(je,{className:"!h-8",variant:"outlined",size:"lg",endDecorator:e.jsx(ye,{onDelete:()=>c({reactions:a.reactions.filter(h=>h!==l)})}),children:l},l)),e.jsx(y,{className:"w-32 !rounded-full !pl-3",placeholder:s("common.input"),size:"sm",value:o,onChange:l=>i(l.target.value.trim()),endDecorator:e.jsx(be,{className:"w-5 h-5 text-gray-500 dark:text-gray-400 cursor-pointer hover:text-teal-600",onClick:()=>d()})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.memo-related-settings.enable-blur-nsfw-content")}),e.jsx(M,{checked:a.enableBlurNsfwContent,onChange:l=>c({enableBlurNsfwContent:l.target.checked})})]}),e.jsxs("div",{className:"mt-2 w-full flex flex-row flex-wrap gap-1",children:[a.nsfwTags.map(l=>e.jsx(je,{className:"!h-8",variant:"outlined",size:"lg",endDecorator:e.jsx(ye,{onDelete:()=>c({nsfwTags:a.nsfwTags.filter(h=>h!==l)})}),children:l},l)),e.jsx(y,{className:"w-32 !rounded-full !pl-3",placeholder:s("common.input"),size:"sm",value:r,onChange:l=>x(l.target.value.trim()),endDecorator:e.jsx(be,{className:"w-5 h-5 text-gray-500 dark:text-gray-400 cursor-pointer hover:text-teal-600",onClick:()=>u()})})]})]}),e.jsx("div",{className:"mt-2 w-full flex justify-end",children:e.jsx(w,{color:"primary",disabled:I(a,t),onClick:k,children:s("common.save")})})]})},xs=({destroy:s})=>{const t=C(),a=F(),[n,o]=f.useState({avatarUrl:a.avatarUrl,username:a.username,nickname:a.nickname,email:a.email,description:a.description}),i=S.state.generalSetting,r=()=>{s()},x=p=>{o(N=>({...N,...p}))},c=async p=>{const N=p.target.files;if(N&&N.length>0){const U=N[0];if(U.size>2*1024*1024){v.error("Max file size is 2MB");return}try{const g=await He(U);x({avatarUrl:g})}catch(g){console.error(g),v.error("Failed to convert image to base64")}}},d=p=>{x({nickname:p.target.value})},u=p=>{x({username:p.target.value})},k=p=>{o(N=>({...N,email:p.target.value}))},l=p=>{o(N=>({...N,description:p.target.value}))},h=async()=>{if(n.username===""){v.error(t("message.fill-all"));return}try{const p=[];I(a.username,n.username)||p.push("username"),I(a.nickname,n.nickname)||p.push("nickname"),I(a.email,n.email)||p.push("email"),I(a.avatarUrl,n.avatarUrl)||p.push("avatar_url"),I(a.description,n.description)||p.push("description"),await L.updateUser(re.fromPartial({name:a.name,username:n.username,nickname:n.nickname,email:n.email,avatarUrl:n.avatarUrl,description:n.description}),p),v.success(t("message.update-succeed")),r()}catch(p){console.error(p),v.error(p.details)}};return e.jsxs("div",{className:"max-w-full shadow flex flex-col justify-start items-start bg-white dark:bg-zinc-800 dark:text-gray-300 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex flex-row justify-between items-center mb-4 gap-2 w-full",children:[e.jsx("p",{className:"title-text",children:t("setting.account-section.update-information")}),e.jsx(w,{size:"sm",variant:"plain",onClick:r,children:e.jsx(_,{className:"w-5 h-auto"})})]}),e.jsxs("div",{className:"flex flex-col justify-start items-start !w-64 space-y-2",children:[e.jsxs("div",{className:"w-full flex flex-row justify-start items-center",children:[e.jsx("span",{className:"text-sm mr-2",children:t("common.avatar")}),e.jsxs("label",{className:"relative cursor-pointer hover:opacity-80",children:[e.jsx(Ie,{className:"!w-10 !h-10",avatarUrl:n.avatarUrl}),e.jsx("input",{type:"file",accept:"image/*",className:"absolute invisible w-full h-full inset-0",onChange:c})]}),n.avatarUrl&&e.jsx(_,{className:"w-4 h-auto ml-1 cursor-pointer opacity-60 hover:opacity-80",onClick:()=>x({avatarUrl:""})})]}),e.jsxs("p",{className:"text-sm",children:[t("common.username"),e.jsxs("span",{className:"text-sm text-gray-400 ml-1",children:["(",t("setting.account-section.username-note"),")"]})]}),e.jsx(y,{className:"w-full",value:n.username,onChange:u,disabled:i.disallowChangeUsername}),e.jsxs("p",{className:"text-sm",children:[t("common.nickname"),e.jsxs("span",{className:"text-sm text-gray-400 ml-1",children:["(",t("setting.account-section.nickname-note"),")"]})]}),e.jsx(y,{className:"w-full",value:n.nickname,onChange:d,disabled:i.disallowChangeNickname}),e.jsxs("p",{className:"text-sm",children:[t("common.email"),e.jsxs("span",{className:"text-sm text-gray-400 ml-1",children:["(",t("setting.account-section.email-note"),")"]})]}),e.jsx(y,{fullWidth:!0,type:"email",value:n.email,onChange:k}),e.jsx("p",{className:"text-sm",children:t("common.description")}),e.jsx(ee,{className:"w-full",color:"neutral",minRows:2,maxRows:4,value:n.description,onChange:l}),e.jsxs("div",{className:"w-full flex flex-row justify-end items-center pt-4 space-x-2",children:[e.jsx(w,{variant:"plain",onClick:r,children:t("common.cancel")}),e.jsx(w,{color:"primary",onClick:h,children:t("common.save")})]})]})]})};function hs(){$({className:"update-account-dialog",dialogName:"update-account-dialog"},xs)}const us=s=>{const{destroy:t,onConfirm:a}=s,n=C(),o=F(),[i,r]=f.useState({description:"",expiration:3600*8}),x=Le(!1),c=[{label:n("setting.access-token-section.create-dialog.duration-8h"),value:3600*8},{label:n("setting.access-token-section.create-dialog.duration-1m"),value:3600*24*30},{label:n("setting.access-token-section.create-dialog.duration-never"),value:0}],d=h=>{r({...i,...h})},u=h=>{d({description:h.target.value})},k=h=>{d({expiration:Number(h.target.value)})},l=async()=>{if(!i.description){v.error(n("message.description-is-required"));return}try{await V.createUserAccessToken({name:o.name,description:i.description,expiresAt:i.expiration?new Date(Date.now()+i.expiration*1e3):void 0}),a(),t()}catch(h){v.error(h.details),console.error(h)}};return e.jsxs("div",{className:"max-w-full shadow flex flex-col justify-start items-start bg-white dark:bg-zinc-800 dark:text-gray-300 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex flex-row justify-between items-center w-full mb-4 gap-2",children:[e.jsx("p",{children:n("setting.access-token-section.create-dialog.create-access-token")}),e.jsx(w,{size:"sm",variant:"plain",onClick:()=>t(),children:e.jsx(_,{className:"w-5 h-auto"})})]}),e.jsxs("div",{className:"flex flex-col justify-start items-start !w-80",children:[e.jsxs("div",{className:"w-full flex flex-col justify-start items-start mb-3",children:[e.jsxs("span",{className:"mb-2",children:[n("setting.access-token-section.create-dialog.description")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("div",{className:"relative w-full",children:e.jsx(y,{className:"w-full",type:"text",placeholder:n("setting.access-token-section.create-dialog.some-description"),value:i.description,onChange:u})})]}),e.jsxs("div",{className:"w-full flex flex-col justify-start items-start mb-3",children:[e.jsxs("span",{className:"mb-2",children:[n("setting.access-token-section.create-dialog.expiration")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("div",{className:"w-full flex flex-row justify-start items-center text-base",children:e.jsx(ce,{orientation:"horizontal",value:i.expiration,onChange:k,children:c.map(h=>e.jsx(G,{value:h.value,checked:i.expiration===h.value,label:h.label},h.value))})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-end items-center mt-4 space-x-2",children:[e.jsx(w,{variant:"plain",disabled:x.isLoading,onClick:t,children:n("common.cancel")}),e.jsx(w,{color:"primary",disabled:x.isLoading,onClick:l,children:n("common.create")})]})]})]})};function gs(s){$({className:"create-access-token-dialog",dialogName:"create-access-token-dialog"},us,{onConfirm:s})}const Oe=s=>{const{className:t,url:a,title:n}=s,o=C();return e.jsx(Te,{title:n!=null?n:o("common.learn-more"),placement:"top",children:e.jsx("a",{className:"text-gray-500 dark:text-gray-400 hover:text-blue-600 ".concat(t),href:a,target:"_blank",children:e.jsx(he,{className:"w-4 h-auto"})})})},Ce=async s=>{const{accessTokens:t}=await V.listUserAccessTokens({name:s});return t.sort((a,n)=>{var o,i,r,x;return((i=(o=n.issuedAt)==null?void 0:o.getTime())!=null?i:0)-((x=(r=a.issuedAt)==null?void 0:r.getTime())!=null?x:0)})},ps=()=>{const s=C(),t=F(),[a,n]=f.useState([]);f.useEffect(()=>{Ce(t.name).then(c=>{n(c)})},[]);const o=async()=>{const c=await Ce(t.name);n(c)},i=c=>{Ge(c),v.success(s("setting.access-token-section.access-token-copied-to-clipboard"))},r=async c=>{const d=x(c);window.confirm(s("setting.access-token-section.access-token-deletion",{accessToken:d}))&&(await V.deleteUserAccessToken({name:t.name,accessToken:c}),n(a.filter(k=>k.accessToken!==c)))},x=c=>"".concat(c.slice(0,4),"****").concat(c.slice(-4));return e.jsx("div",{className:"mt-6 w-full flex flex-col justify-start items-start space-y-4",children:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"sm:flex sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"sm:flex-auto space-y-1",children:[e.jsxs("p",{className:"flex flex-row justify-start items-center font-medium text-gray-700 dark:text-gray-400",children:[s("setting.access-token-section.title"),e.jsx(Oe,{className:"ml-2",url:"https://usememos.com/docs/security/access-tokens"})]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-500",children:s("setting.access-token-section.description")})]}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsx(w,{color:"primary",onClick:()=>{gs(o)},children:s("common.create")})})]}),e.jsx("div",{className:"w-full mt-2 flow-root",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"inline-block min-w-full border rounded-lg align-middle dark:border-zinc-600",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300 dark:divide-zinc-600",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-gray-900 dark:text-gray-400",children:s("setting.access-token-section.token")}),e.jsx("th",{scope:"col",className:"py-2 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 dark:text-gray-400",children:s("common.description")}),e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-gray-900 dark:text-gray-400",children:s("setting.access-token-section.create-dialog.created-at")}),e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-gray-900 dark:text-gray-400",children:s("setting.access-token-section.create-dialog.expires-at")}),e.jsx("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4",children:e.jsx("span",{className:"sr-only",children:s("common.delete")})})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-zinc-700",children:a.map(c=>{var d,u,k;return e.jsxs("tr",{children:[e.jsxs("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-900 dark:text-gray-400 flex flex-row justify-start items-center gap-x-1",children:[e.jsx("span",{className:"font-mono",children:x(c.accessToken)}),e.jsx(w,{variant:"plain",size:"sm",onClick:()=>i(c.accessToken),children:e.jsx(as,{className:"w-4 h-auto text-gray-400"})})]}),e.jsx("td",{className:"whitespace-nowrap py-2 pl-4 pr-3 text-sm text-gray-900 dark:text-gray-400",children:c.description}),e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-500 dark:text-gray-400",children:(d=c.issuedAt)==null?void 0:d.toLocaleString()}),e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-500 dark:text-gray-400",children:(k=(u=c.expiresAt)==null?void 0:u.toLocaleString())!=null?k:s("setting.access-token-section.create-dialog.duration-never")}),e.jsx("td",{className:"relative whitespace-nowrap py-2 pl-3 pr-4 text-right text-sm",children:e.jsx(w,{variant:"plain",size:"sm",onClick:()=>{r(c.accessToken)},children:e.jsx(Ee,{className:"text-red-600 w-4 h-auto"})})})]},c.accessToken)})})]})})})})]})})},fs=()=>{const s=C(),t=F();return e.jsxs("div",{className:"w-full gap-2 pt-2 pb-4",children:[e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-500",children:s("setting.account-section.title")}),e.jsxs("div",{className:"w-full mt-2 flex flex-row justify-start items-center",children:[e.jsx(Ie,{className:"mr-2 shrink-0 w-10 h-10",avatarUrl:t.avatarUrl}),e.jsxs("div",{className:"max-w-[calc(100%-3rem)] flex flex-col justify-center items-start",children:[e.jsxs("p",{className:"w-full",children:[e.jsx("span",{className:"text-xl leading-tight font-medium",children:t.nickname}),e.jsxs("span",{className:"ml-1 text-base leading-tight text-gray-500 dark:text-gray-400",children:["(",t.username,")"]})]}),e.jsx("p",{className:"w-4/5 leading-tight text-sm truncate",children:t.description})]})]}),e.jsxs("div",{className:"w-full flex flex-row justify-start items-center mt-2 space-x-2",children:[e.jsxs(w,{variant:"outlined",size:"sm",onClick:hs,children:[e.jsx(Ve,{className:"w-4 h-4 mx-auto mr-1"}),s("common.edit")]}),e.jsxs(oe,{children:[e.jsx(de,{slots:{root:"div"},children:e.jsx(w,{variant:"outlined",size:"sm",children:e.jsx(xe,{className:"w-4 h-4 mx-auto"})})}),e.jsx(me,{className:"text-sm",size:"sm",placement:"bottom",children:e.jsx(R,{onClick:()=>We(t),children:s("setting.account-section.change-password")})})]})]}),e.jsx(ps,{})]})},js=s=>{const{webhookId:t,destroy:a,onConfirm:n}=s,o=C(),[i,r]=f.useState({name:"",url:""}),x=Le(!1),c=t===void 0;f.useEffect(()=>{t&&K.getWebhook({id:t}).then(h=>{r({name:h.name,url:h.url})})},[]);const d=h=>{r({...i,...h})},u=h=>{d({name:h.target.value})},k=h=>{d({url:h.target.value})},l=async()=>{if(!i.name||!i.url){v.error(o("message.fill-all-required-fields"));return}try{c?await K.createWebhook({name:i.name,url:i.url}):await K.updateWebhook({webhook:{id:t,name:i.name,url:i.url},updateMask:["name","url"]}),n(),a()}catch(h){console.error(h),v.error(h.details)}};return e.jsxs("div",{className:"max-w-full shadow flex flex-col justify-start items-start bg-white dark:bg-zinc-800 dark:text-gray-300 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex flex-row justify-between items-center mb-4 gap-2 w-full",children:[e.jsx("p",{className:"title-text",children:o(c?"setting.webhook-section.create-dialog.create-webhook":"setting.webhook-section.create-dialog.edit-webhook")}),e.jsx(w,{size:"sm",variant:"plain",onClick:()=>a(),children:e.jsx(_,{className:"w-5 h-auto"})})]}),e.jsxs("div",{className:"flex flex-col justify-start items-start !w-80",children:[e.jsxs("div",{className:"w-full flex flex-col justify-start items-start mb-3",children:[e.jsxs("span",{className:"mb-2",children:[o("setting.webhook-section.create-dialog.title")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("div",{className:"relative w-full",children:e.jsx(y,{className:"w-full",type:"text",placeholder:o("setting.webhook-section.create-dialog.an-easy-to-remember-name"),value:i.name,onChange:u})})]}),e.jsxs("div",{className:"w-full flex flex-col justify-start items-start mb-3",children:[e.jsxs("span",{className:"mb-2",children:[o("setting.webhook-section.create-dialog.payload-url")," ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("div",{className:"relative w-full",children:e.jsx(y,{className:"w-full",type:"text",placeholder:o("setting.webhook-section.create-dialog.url-example-post-receive"),value:i.url,onChange:k})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-end items-center mt-2 space-x-2",children:[e.jsx(w,{variant:"plain",disabled:x.isLoading,onClick:a,children:o("common.cancel")}),e.jsx(w,{color:"primary",disabled:x.isLoading,onClick:l,children:o("common.create")})]})]})]})};function ys(s){$({className:"create-webhook-dialog",dialogName:"create-webhook-dialog"},js,{onConfirm:s})}const Se=async s=>{const{webhooks:t}=await K.listWebhooks({creator:s});return t},ws=()=>{const s=C(),t=F(),[a,n]=f.useState([]);f.useEffect(()=>{Se(t.name).then(r=>{n(r)})},[]);const o=async()=>{const r=await Se(t.name);n(r)},i=async r=>{window.confirm("Are you sure to delete webhook `".concat(r.name,"`? You cannot undo this action."))&&(await K.deleteWebhook({id:r.id}),n(a.filter(c=>c.id!==r.id)))};return e.jsxs("div",{className:"w-full flex flex-col justify-start items-start",children:[e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsx("div",{className:"flex-auto space-y-1",children:e.jsx("p",{className:"flex flex-row justify-start items-center font-medium text-gray-700 dark:text-gray-400",children:s("setting.webhook-section.title")})}),e.jsx("div",{children:e.jsx(w,{color:"primary",onClick:()=>{ys(o)},children:s("common.create")})})]}),e.jsx("div",{className:"w-full mt-2 flow-root",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"inline-block min-w-full border rounded-lg align-middle dark:border-zinc-600",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300 dark:divide-zinc-600",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-gray-900 dark:text-gray-400",children:s("common.name")}),e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-gray-900 dark:text-gray-400",children:s("setting.webhook-section.url")}),e.jsx("th",{scope:"col",className:"relative px-3 py-2 pr-4",children:e.jsx("span",{className:"sr-only",children:s("common.delete")})})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-500",children:[a.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-900 dark:text-gray-400",children:r.name}),e.jsx("td",{className:"max-w-[200px] px-3 py-2 text-sm text-gray-900 dark:text-gray-400 truncate",title:r.url,children:r.url}),e.jsx("td",{className:"relative whitespace-nowrap px-3 py-2 text-right text-sm",children:e.jsx(w,{variant:"plain",size:"sm",onClick:()=>{i(r)},children:e.jsx(Ee,{className:"text-red-600 w-4 h-auto"})})})]},r.id)),a.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-900 dark:text-gray-400",colSpan:3,children:s("setting.webhook-section.no-webhooks-found")})})]})]})})})}),e.jsx("div",{className:"w-full mt-2",children:e.jsxs(Y,{className:"text-gray-500 text-sm inline-flex flex-row justify-start items-center hover:underline hover:text-blue-600",to:"https://usememos.com/docs/advanced-settings/webhook",target:"_blank",children:[s("common.learn-more"),e.jsx(he,{className:"inline w-4 h-auto ml-1"})]})})]})},vs=Pe(()=>{const s=C(),t=L.state.userSetting,a=async i=>{await L.updateUserSetting({locale:i},["locale"])},n=async i=>{await L.updateUserSetting({appearance:i},["appearance"])},o=async i=>{await L.updateUserSetting({memoVisibility:i},["memo_visibility"])};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-500",children:s("common.basic")}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("common.language")}),e.jsx(De,{value:t.locale,onChange:a})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.preference-section.theme")}),e.jsx(Re,{value:t.appearance,onChange:n})]}),e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-500",children:s("setting.preference")}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"truncate",children:s("setting.preference-section.default-memo-visibility")}),e.jsx(q,{className:"!min-w-fit",value:t.memoVisibility,startDecorator:e.jsx(Ke,{visibility:qe(t.memoVisibility)}),onChange:(i,r)=>{r&&o(r)},children:[te.PRIVATE,te.PROTECTED,te.PUBLIC].map(i=>$e(i)).map(i=>e.jsx(O,{value:i,className:"whitespace-nowrap",children:s("memo.visibility.".concat(i.toLowerCase()))},i))})]}),e.jsx(B,{className:"!my-3"}),e.jsx(ws,{})]})}),ae=[{name:"",title:"GitHub",type:W.OAUTH2,identifierFilter:"",config:{oauth2Config:{clientId:"",clientSecret:"",authUrl:"https://github.com/login/oauth/authorize",tokenUrl:"https://github.com/login/oauth/access_token",userInfoUrl:"https://api.github.com/user",scopes:["read:user"],fieldMapping:{identifier:"login",displayName:"name",email:"email"}}}},{name:"",title:"GitLab",type:W.OAUTH2,identifierFilter:"",config:{oauth2Config:{clientId:"",clientSecret:"",authUrl:"https://gitlab.com/oauth/authorize",tokenUrl:"https://gitlab.com/oauth/token",userInfoUrl:"https://gitlab.com/oauth/userinfo",scopes:["openid"],fieldMapping:{identifier:"name",displayName:"name",email:"email"}}}},{name:"",title:"Google",type:W.OAUTH2,identifierFilter:"",config:{oauth2Config:{clientId:"",clientSecret:"",authUrl:"https://accounts.google.com/o/oauth2/v2/auth",tokenUrl:"https://oauth2.googleapis.com/token",userInfoUrl:"https://www.googleapis.com/oauth2/v2/userinfo",scopes:["https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/userinfo.profile"],fieldMapping:{identifier:"email",displayName:"name",email:"email"}}}},{name:"",title:"Custom",type:W.OAUTH2,identifierFilter:"",config:{oauth2Config:{clientId:"",clientSecret:"",authUrl:"",tokenUrl:"",userInfoUrl:"",scopes:[],fieldMapping:{identifier:"",displayName:"",email:""}}}}],ks=s=>{const t=C(),a=[...new Set(ae.map(m=>m.type))],{confirmCallback:n,destroy:o,identityProvider:i}=s,[r,x]=f.useState({title:"",identifierFilter:""}),[c,d]=f.useState(W.OAUTH2),[u,k]=f.useState({clientId:"",clientSecret:"",authUrl:"",tokenUrl:"",userInfoUrl:"",scopes:[],fieldMapping:{identifier:"",displayName:"",email:""}}),[l,h]=f.useState(""),[p,N]=f.useState("GitHub"),U=i===void 0;f.useEffect(()=>{var m;if(i&&(x({title:i.title,identifierFilter:i.identifierFilter}),d(i.type),i.type===W.OAUTH2)){const j=ve.fromPartial(((m=i.config)==null?void 0:m.oauth2Config)||{});k(j),h(j.scopes.join(" "))}},[]),f.useEffect(()=>{var j;if(!U)return;const m=ae.find(b=>b.title===p);if(m&&(x({title:m.title,identifierFilter:m.identifierFilter}),d(m.type),m.type===W.OAUTH2)){const b=ve.fromPartial(((j=m.config)==null?void 0:j.oauth2Config)||{});k(b),h(b.scopes.join(" "))}},[p]);const g=()=>{o()},H=()=>{var m;return!(r.title===""||c==="OAUTH2"&&(u.clientId===""||u.authUrl===""||u.tokenUrl===""||u.userInfoUrl===""||l===""||((m=u.fieldMapping)==null?void 0:m.identifier)===""||U&&u.clientSecret===""))},Q=async()=>{try{U?(await Z.createIdentityProvider({identityProvider:{...r,type:c,config:{oauth2Config:{...u,scopes:l.split(" ")}}}}),v.success(t("setting.sso-section.sso-created",{name:r.title}))):(await Z.updateIdentityProvider({identityProvider:{...r,name:i.name,type:c,config:{oauth2Config:{...u,scopes:l.split(" ")}}},updateMask:["title","identifier_filter","config"]}),v.success(t("setting.sso-section.sso-updated",{name:r.title})))}catch(m){v.error(m.details),console.error(m)}n&&n(),o()},T=m=>{k({...u,...m})};return e.jsxs("div",{className:"max-w-full shadow flex flex-col justify-start items-start bg-white dark:bg-zinc-800 dark:text-gray-300 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex flex-row justify-between items-center mb-4 gap-2 w-full",children:[e.jsx("p",{children:t(U?"setting.sso-section.create-sso":"setting.sso-section.update-sso")}),e.jsx(w,{size:"sm",variant:"plain",onClick:g,children:e.jsx(_,{className:"w-5 h-auto"})})]}),e.jsxs("div",{className:"flex flex-col justify-start items-start w-80",children:[U&&e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"!mb-1",level:"body-md",children:t("common.type")}),e.jsx(q,{className:"w-full mb-4",value:c,onChange:(m,j)=>d(j!=null?j:c),children:a.map(m=>e.jsx(O,{value:m,children:m},m))}),e.jsx(A,{className:"mb-2",level:"body-md",children:t("setting.sso-section.template")}),e.jsx(q,{className:"mb-1 h-auto w-full",value:p,onChange:(m,j)=>N(j!=null?j:p),children:ae.map(m=>e.jsx(O,{value:m.title,children:m.title},m.title))}),e.jsx(B,{className:"!my-2"})]}),e.jsxs(A,{className:"!mb-1",level:"body-md",children:[t("common.name"),e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(y,{className:"mb-2",placeholder:t("common.name"),value:r.title,onChange:m=>x({...r,title:m.target.value}),fullWidth:!0}),e.jsx(A,{className:"!mb-1",level:"body-md",children:t("setting.sso-section.identifier-filter")}),e.jsx(y,{className:"mb-2",placeholder:t("setting.sso-section.identifier-filter"),value:r.identifierFilter,onChange:m=>x({...r,identifierFilter:m.target.value}),fullWidth:!0}),e.jsx(B,{className:"!my-2"}),c==="OAUTH2"&&e.jsxs(e.Fragment,{children:[U&&e.jsxs("p",{className:"border rounded-md p-2 text-sm w-full mb-2 break-all",children:[t("setting.sso-section.redirect-url"),": ",Ye("/auth/callback")]}),e.jsxs(A,{className:"!mb-1",level:"body-md",children:[t("setting.sso-section.client-id"),e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(y,{className:"mb-2",placeholder:t("setting.sso-section.client-id"),value:u.clientId,onChange:m=>T({clientId:m.target.value}),fullWidth:!0}),e.jsxs(A,{className:"!mb-1",level:"body-md",children:[t("setting.sso-section.client-secret"),e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(y,{className:"mb-2",placeholder:t("setting.sso-section.client-secret"),value:u.clientSecret,onChange:m=>T({clientSecret:m.target.value}),fullWidth:!0}),e.jsxs(A,{className:"!mb-1",level:"body-md",children:[t("setting.sso-section.authorization-endpoint"),e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(y,{className:"mb-2",placeholder:t("setting.sso-section.authorization-endpoint"),value:u.authUrl,onChange:m=>T({authUrl:m.target.value}),fullWidth:!0}),e.jsxs(A,{className:"!mb-1",level:"body-md",children:[t("setting.sso-section.token-endpoint"),e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(y,{className:"mb-2",placeholder:t("setting.sso-section.token-endpoint"),value:u.tokenUrl,onChange:m=>T({tokenUrl:m.target.value}),fullWidth:!0}),e.jsxs(A,{className:"!mb-1",level:"body-md",children:[t("setting.sso-section.user-endpoint"),e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(y,{className:"mb-2",placeholder:t("setting.sso-section.user-endpoint"),value:u.userInfoUrl,onChange:m=>T({userInfoUrl:m.target.value}),fullWidth:!0}),e.jsxs(A,{className:"!mb-1",level:"body-md",children:[t("setting.sso-section.scopes"),e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(y,{className:"mb-2",placeholder:t("setting.sso-section.scopes"),value:l,onChange:m=>h(m.target.value),fullWidth:!0}),e.jsx(B,{className:"!my-2"}),e.jsxs(A,{className:"!mb-1",level:"body-md",children:[t("setting.sso-section.identifier"),e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(y,{className:"mb-2",placeholder:t("setting.sso-section.identifier"),value:u.fieldMapping.identifier,onChange:m=>T({fieldMapping:{...u.fieldMapping,identifier:m.target.value}}),fullWidth:!0}),e.jsx(A,{className:"!mb-1",level:"body-md",children:t("setting.sso-section.display-name")}),e.jsx(y,{className:"mb-2",placeholder:t("setting.sso-section.display-name"),value:u.fieldMapping.displayName,onChange:m=>T({fieldMapping:{...u.fieldMapping,displayName:m.target.value}}),fullWidth:!0}),e.jsx(A,{className:"!mb-1",level:"body-md",children:t("common.email")}),e.jsx(y,{className:"mb-2",placeholder:t("common.email"),value:u.fieldMapping.email,onChange:m=>T({fieldMapping:{...u.fieldMapping,email:m.target.value}}),fullWidth:!0})]}),e.jsxs("div",{className:"mt-2 w-full flex flex-row justify-end items-center space-x-1",children:[e.jsx(w,{variant:"plain",onClick:g,children:t("common.cancel")}),e.jsx(w,{color:"primary",onClick:Q,disabled:!H(),children:t(U?"common.create":"common.update")})]})]})]})};function Ue(s,t){$({className:"create-identity-provider-dialog",dialogName:"create-identity-provider-dialog"},ks,{identityProvider:s,confirmCallback:t})}const Ns=()=>{const s=C(),[t,a]=f.useState([]);f.useEffect(()=>{n()},[]);const n=async()=>{const{identityProviders:i}=await Z.listIdentityProviders({});a(i)},o=async i=>{if(window.confirm(s("setting.sso-section.confirm-delete",{name:i.title}))){try{await Z.deleteIdentityProvider({name:i.name})}catch(x){console.error(x),v.error(x.details)}await n()}};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsxs("div",{className:"w-full flex flex-row justify-between items-center gap-1",children:[e.jsxs("div",{className:"flex flex-row items-center gap-1",children:[e.jsx("span",{className:"font-mono text-gray-400",children:s("setting.sso-section.sso-list")}),e.jsx(Oe,{url:"https://www.usememos.com/docs/advanced-settings/sso"})]}),e.jsx(w,{color:"primary",onClick:()=>Ue(void 0,n),children:s("common.create")})]}),e.jsx(B,{}),t.map(i=>e.jsxs("div",{className:"py-2 w-full border-b last:border-b dark:border-zinc-700 flex flex-row items-center justify-between",children:[e.jsx("div",{className:"flex flex-row items-center",children:e.jsxs("p",{className:"ml-2",children:[i.title,e.jsxs("span",{className:"text-sm ml-1 opacity-40",children:["(",i.type,")"]})]})}),e.jsx("div",{className:"flex flex-row items-center",children:e.jsxs(oe,{children:[e.jsx(de,{size:"sm",children:e.jsx(xe,{className:"w-4 h-auto"})}),e.jsxs(me,{placement:"bottom-end",size:"sm",children:[e.jsx(R,{onClick:()=>Ue(i,n),children:s("common.edit")}),e.jsx(R,{onClick:()=>o(i),children:s("common.delete")})]})]})})]},i.name)),t.length===0&&e.jsx("div",{className:"w-full mt-2 text-sm dark:border-zinc-700 opacity-60 flex flex-row items-center justify-between",children:e.jsx("p",{className:"",children:s("setting.sso-section.no-sso-found")})}),e.jsxs("div",{className:"w-full mt-4",children:[e.jsxs("p",{className:"text-sm",children:[s("common.learn-more"),":"]}),e.jsx(ze,{component:"ul",marker:"disc",size:"sm",children:e.jsx(ie,{children:e.jsx(Y,{className:"text-sm text-blue-600 hover:underline",to:"https://www.usememos.com/docs/advanced-settings/sso",target:"_blank",children:s("setting.sso-section.single-sign-on")})})})]})]})},Ae=({text:s,icon:t,isSelected:a,onClick:n})=>e.jsxs("div",{onClick:n,className:"w-auto max-w-full px-3 leading-8 flex flex-row justify-start items-center cursor-pointer rounded-lg select-none hover:opacity-80 ".concat(a?"bg-zinc-100 shadow dark:bg-zinc-900":""),children:[e.jsx(t,{className:"w-4 h-auto mr-2 opacity-80 shrink-0"}),e.jsx("span",{className:"truncate",children:s})]}),bs=()=>{var N,U,g,H,Q,T,m;const s=C(),[t,a]=f.useState(ke.fromPartial(((N=S.getWorkspaceSettingByKey(z.STORAGE))==null?void 0:N.storageSetting)||{})),n=f.useMemo(()=>{var b,X,ue,ge,pe,fe;if(t.uploadSizeLimitMb<=0)return!1;const j=ke.fromPartial(((b=S.getWorkspaceSettingByKey(z.STORAGE))==null?void 0:b.storageSetting)||{});if(t.storageType===D.LOCAL){if(t.filepathTemplate.length===0)return!1}else if(t.storageType===D.S3&&(((X=t.s3Config)==null?void 0:X.accessKeyId.length)===0||((ue=t.s3Config)==null?void 0:ue.accessKeySecret.length)===0||((ge=t.s3Config)==null?void 0:ge.endpoint.length)===0||((pe=t.s3Config)==null?void 0:pe.region.length)===0||((fe=t.s3Config)==null?void 0:fe.bucket.length)===0))return!1;return!I(j,t)},[t,S.state]),o=async j=>{let b=parseInt(j.target.value);Number.isNaN(b)&&(b=0);const X={...t,uploadSizeLimitMb:b};a(X)},i=async j=>{const b={...t,filepathTemplate:j.target.value};a(b)},r=async j=>{const b={...t,s3Config:Ze.fromPartial({...t.s3Config,...j})};a(b)},x=async j=>{r({accessKeyId:j.target.value})},c=async j=>{r({accessKeySecret:j.target.value})},d=async j=>{r({endpoint:j.target.value})},u=async j=>{r({region:j.target.value})},k=async j=>{r({bucket:j.target.value})},l=j=>{r({usePathStyle:j.target.checked})},h=async j=>{const b={...t,storageType:j};a(b)},p=async()=>{await S.upsertWorkspaceSetting({name:"".concat(se).concat(z.STORAGE),storageSetting:t}),v.success("Updated")};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsx("div",{className:"font-medium text-gray-700 dark:text-gray-500",children:s("setting.storage-section.current-storage")}),e.jsxs(ce,{orientation:"horizontal",className:"w-full",value:t.storageType,onChange:j=>{h(j.target.value)},children:[e.jsx(G,{value:D.DATABASE,label:s("setting.storage-section.type-database")}),e.jsx(G,{value:D.LOCAL,label:s("setting.storage-section.type-local")}),e.jsx(G,{value:D.S3,label:"S3"})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-500 mr-1",children:s("setting.system-section.max-upload-size")}),e.jsx(Te,{title:s("setting.system-section.max-upload-size-hint"),placement:"top",children:e.jsx(ts,{className:"w-4 h-auto"})})]}),e.jsx(y,{className:"w-16 font-mono",value:t.uploadSizeLimitMb,onChange:o})]}),t.storageType!==D.DATABASE&&e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-500 mr-1",children:s("setting.storage-section.filepath-template")}),e.jsx(y,{value:t.filepathTemplate,placeholder:"assets/{timestamp}_{filename}",onChange:i})]}),t.storageType===D.S3&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-500 mr-1",children:"Access key id"}),e.jsx(y,{value:(U=t.s3Config)==null?void 0:U.accessKeyId,placeholder:"",onChange:x})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-500 mr-1",children:"Access key secret"}),e.jsx(y,{value:(g=t.s3Config)==null?void 0:g.accessKeySecret,placeholder:"",onChange:c})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-500 mr-1",children:"Endpoint"}),e.jsx(y,{value:(H=t.s3Config)==null?void 0:H.endpoint,placeholder:"",onChange:d})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-500 mr-1",children:"Region"}),e.jsx(y,{value:(Q=t.s3Config)==null?void 0:Q.region,placeholder:"",onChange:u})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-500 mr-1",children:"Bucket"}),e.jsx(y,{value:(T=t.s3Config)==null?void 0:T.bucket,placeholder:"",onChange:k})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-500 mr-1",children:"Use Path Style"}),e.jsx(M,{checked:(m=t.s3Config)==null?void 0:m.usePathStyle,onChange:l})]})]}),e.jsx("div",{children:e.jsx(w,{color:"primary",disabled:!n,onClick:p,children:s("common.save")})}),e.jsx(B,{className:"!my-2"}),e.jsxs("div",{className:"w-full mt-4",children:[e.jsxs("p",{className:"text-sm",children:[s("common.learn-more"),":"]}),e.jsxs(ze,{component:"ul",marker:"disc",size:"sm",children:[e.jsx(ie,{children:e.jsx(Y,{className:"text-sm text-blue-600 hover:underline",to:"https://www.usememos.com/docs/advanced-settings/local-storage",target:"_blank",children:"Docs - Local storage"})}),e.jsx(ie,{children:e.jsx(Y,{className:"text-sm text-blue-600 hover:underline",to:"https://www.usememos.com/blog/choosing-a-storage-for-your-resource",target:"_blank",children:"Choosing a Storage for Your Resource: Database, S3 or Local Storage?"})})]})]})]})},Cs=({destroy:s})=>{const t=C(),a=S.state.generalSetting,[n,o]=f.useState(Qe.fromPartial(a.customProfile||{})),i=()=>{s()},r=p=>{o(N=>({...N,...p}))},x=p=>{r({title:p.target.value})},c=p=>{r({logoUrl:p.target.value})},d=p=>{r({description:p.target.value})},u=p=>{r({locale:p})},k=p=>{r({appearance:p})},l=()=>{r({title:"Memos",logoUrl:"/logo.webp",description:"",locale:"en",appearance:"system"})},h=async()=>{if(n.title===""){v.error("Title cannot be empty.");return}try{await S.upsertWorkspaceSetting({name:"".concat(se).concat(z.GENERAL),generalSetting:{...a,customProfile:n}})}catch(p){console.error(p);return}v.success(t("message.update-succeed")),s()};return e.jsxs("div",{className:"max-w-full shadow flex flex-col justify-start items-start bg-white dark:bg-zinc-800 dark:text-gray-300 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex flex-row justify-between items-center mb-4 gap-2 w-full",children:[e.jsx("p",{className:"title-text",children:t("setting.system-section.customize-server.title")}),e.jsx(w,{size:"sm",variant:"plain",onClick:i,children:e.jsx(_,{className:"w-5 h-auto"})})]}),e.jsxs("div",{className:"flex flex-col justify-start items-start min-w-[16rem]",children:[e.jsx("p",{className:"text-sm mb-1",children:t("setting.system-section.server-name")}),e.jsx(y,{className:"w-full",type:"text",value:n.title,onChange:x}),e.jsx("p",{className:"text-sm mb-1 mt-2",children:t("setting.system-section.customize-server.icon-url")}),e.jsx(y,{className:"w-full",type:"text",value:n.logoUrl,onChange:c}),e.jsx("p",{className:"text-sm mb-1 mt-2",children:t("setting.system-section.customize-server.description")}),e.jsx(ee,{className:"w-full",minRows:"2",maxRows:"4",value:n.description,onChange:d}),e.jsx("p",{className:"text-sm mb-1 mt-2",children:t("setting.system-section.customize-server.locale")}),e.jsx(De,{className:"!w-full",value:n.locale,onChange:u}),e.jsx("p",{className:"text-sm mb-1 mt-2",children:t("setting.system-section.customize-server.appearance")}),e.jsx(Re,{className:"!w-full",value:n.appearance,onChange:k}),e.jsxs("div",{className:"mt-4 w-full flex flex-row justify-between items-center space-x-2",children:[e.jsx("div",{className:"flex flex-row justify-start items-center",children:e.jsx(w,{variant:"outlined",onClick:l,children:t("common.restore")})}),e.jsxs("div",{className:"flex flex-row justify-end items-center gap-2",children:[e.jsx(w,{variant:"plain",onClick:i,children:t("common.cancel")}),e.jsx(w,{color:"primary",onClick:h,children:t("common.save")})]})]})]})]})};function Ss(){$({className:"update-customized-profile-dialog",dialogName:"update-customized-profile-dialog"},Cs)}const Us=()=>{var u,k;const s=C(),t=Ne.fromPartial(((u=S.getWorkspaceSettingByKey(z.GENERAL))==null?void 0:u.generalSetting)||{}),[a,n]=f.useState(t),[o,i]=f.useState([]);f.useEffect(()=>{n(t)},[S.getWorkspaceSettingByKey(z.GENERAL)]);const r=()=>{Ss()},x=l=>{n(Ne.fromPartial({...a,...l}))},c=async()=>{try{await S.upsertWorkspaceSetting({name:"".concat(se).concat(z.GENERAL),generalSetting:a})}catch(l){v.error(l.details),console.error(l);return}v.success(s("message.update-succeed"))};f.useEffect(()=>{d()},[]);const d=async()=>{const{identityProviders:l}=await Z.listIdentityProviders({});i(l)};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-500",children:s("common.basic")}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsxs("div",{children:[s("setting.system-section.server-name"),":"," ",e.jsx("span",{className:"font-mono font-bold",children:((k=a.customProfile)==null?void 0:k.title)||"Memos"})]}),e.jsx(w,{variant:"outlined",onClick:r,children:s("common.edit")})]}),e.jsx(B,{}),e.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-500",children:s("setting.system-section.title")}),e.jsx("div",{className:"w-full flex flex-row justify-between items-center",children:e.jsx("span",{children:s("setting.system-section.additional-style")})}),e.jsx(ee,{className:"w-full",sx:{fontFamily:"monospace",fontSize:"14px"},minRows:2,maxRows:4,placeholder:s("setting.system-section.additional-style-placeholder"),value:a.additionalStyle,onChange:l=>x({additionalStyle:l.target.value})}),e.jsx("div",{className:"w-full flex flex-row justify-between items-center",children:e.jsx("span",{children:s("setting.system-section.additional-script")})}),e.jsx(ee,{className:"w-full",color:"neutral",sx:{fontFamily:"monospace",fontSize:"14px"},minRows:2,maxRows:4,placeholder:s("setting.system-section.additional-script-placeholder"),value:a.additionalScript,onChange:l=>x({additionalScript:l.target.value})}),e.jsx("div",{className:"w-full",children:e.jsxs(Y,{className:"text-gray-500 text-sm flex flex-row justify-start items-center hover:underline hover:text-blue-600",to:"https://usememos.com/docs/advanced-settings/custom-style-and-script",target:"_blank",children:[s("common.learn-more"),e.jsx(he,{className:"inline w-4 h-auto ml-1"})]})}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.workspace-section.disallow-user-registration")}),e.jsx(M,{disabled:S.state.profile.mode==="demo",checked:a.disallowUserRegistration,onChange:l=>x({disallowUserRegistration:l.target.checked})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.workspace-section.disallow-password-auth")}),e.jsx(M,{disabled:S.state.profile.mode==="demo"||o.length===0,checked:a.disallowPasswordAuth,onChange:l=>x({disallowPasswordAuth:l.target.checked})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.workspace-section.disallow-change-username")}),e.jsx(M,{checked:a.disallowChangeUsername,onChange:l=>x({disallowChangeUsername:l.target.checked})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.workspace-section.disallow-change-nickname")}),e.jsx(M,{checked:a.disallowChangeNickname,onChange:l=>x({disallowChangeNickname:l.target.checked})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"truncate",children:s("setting.workspace-section.week-start-day")}),e.jsxs(q,{className:"!min-w-fit",value:a.weekStartDayOffset,onChange:(l,h)=>{x({weekStartDayOffset:h||0})},children:[e.jsx(O,{value:-1,children:s("setting.workspace-section.saturday")}),e.jsx(O,{value:0,children:s("setting.workspace-section.sunday")}),e.jsx(O,{value:1,children:s("setting.workspace-section.monday")})]})]}),e.jsx("div",{className:"mt-2 w-full flex justify-end",children:e.jsx(w,{color:"primary",disabled:I(a,t),onClick:c,children:s("common.save")})})]})},ne=["my-account","preference"],le=["member","system","memo-related","storage","sso"],Me={"my-account":cs,preference:ns,member:ss,system:es,"memo-related":rs,storage:ls,sso:is},Ws=Pe(()=>{const s=C(),{md:t}=Xe(),a=_e(),n=F(),[o,i]=f.useState({selectedSection:"my-account"}),r=n.role===P.HOST,x=f.useMemo(()=>{let d=[...ne];return r&&(d=d.concat(le)),d},[r]);f.useEffect(()=>{let d=a.hash.slice(1);[...ne,...le].includes(d)||(d="my-account"),i({selectedSection:d})},[a.hash]),f.useEffect(()=>{r&&(async()=>[z.MEMO_RELATED,z.STORAGE].forEach(async d=>{await S.fetchWorkspaceSetting(d)}))()},[r]);const c=f.useCallback(d=>{window.location.hash=d},[]);return e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-start sm:pt-3 md:pt-6 pb-8",children:[!t&&e.jsx(Je,{}),e.jsx("div",{className:"w-full px-4 sm:px-6",children:e.jsxs("div",{className:"w-full shadow flex flex-row justify-start items-start px-4 py-3 rounded-xl bg-white dark:bg-zinc-800 text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"hidden sm:flex flex-col justify-start items-start w-40 h-auto shrink-0 py-2",children:[e.jsx("span",{className:"text-sm mt-0.5 pl-3 font-mono select-none text-gray-400 dark:text-gray-500",children:s("common.basic")}),e.jsx("div",{className:"w-full flex flex-col justify-start items-start mt-1",children:ne.map(d=>e.jsx(Ae,{text:s("setting.".concat(d)),icon:Me[d],isSelected:o.selectedSection===d,onClick:()=>c(d)},d))}),r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm mt-4 pl-3 font-mono select-none text-gray-400 dark:text-gray-500",children:s("common.admin")}),e.jsxs("div",{className:"w-full flex flex-col justify-start items-start mt-1",children:[le.map(d=>e.jsx(Ae,{text:s("setting.".concat(d)),icon:Me[d],isSelected:o.selectedSection===d,onClick:()=>c(d)},d)),e.jsxs("span",{className:"px-3 mt-2 opacity-70 text-sm",children:[s("setting.version"),": v",S.state.profile.version]})]})]}):null]}),e.jsxs("div",{className:"w-full grow sm:pl-4 overflow-x-auto",children:[e.jsx("div",{className:"w-auto inline-block my-2 sm:hidden",children:e.jsx(q,{value:o.selectedSection,onChange:(d,u)=>c(u),children:x.map(d=>e.jsx(O,{value:d,children:s("setting.".concat(d))},d))})}),o.selectedSection==="my-account"?e.jsx(fs,{}):o.selectedSection==="preference"?e.jsx(vs,{}):o.selectedSection==="member"?e.jsx(ds,{}):o.selectedSection==="system"?e.jsx(Us,{}):o.selectedSection==="memo-related"?e.jsx(ms,{}):o.selectedSection==="storage"?e.jsx(bs,{}):o.selectedSection==="sso"?e.jsx(Ns,{}):null]})]})})]})});export{Ws as default};
