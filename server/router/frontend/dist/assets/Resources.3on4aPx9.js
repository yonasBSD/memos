import{j as e,D as g,T as N}from"./mui-vendor.BwEHDYNi.js";import{u as v,o as b,b as k,p as R,r as h,n as T,q as S,e as D,s as E,E as M,t as z,R as p,f as F,T as Q}from"./app.BmPucvBz.js";import{d as i}from"./mermaid-vendor.YaF7NM7v.js";import{a as f}from"./react-vendor.DIaRSUZC.js";import{b as Y}from"./utils-vendor.gMQV7HrB.js";import"./highlight-vendor.BCvQicfw.js";import"./katex-vendor.BOojJMwU.js";import"./leaflet-vendor.BDS7nALv.js";function C(r){const c=new Map;return r.sort((l,t)=>i(t.createTime).unix()-i(l.createTime).unix()).forEach(l=>{var o;const t=i(l.createTime).format("YYYY-MM");c.has(t)||c.set(t,[]),(o=c.get(t))==null||o.push(l)}),c}const O=()=>{const r=v(),{md:c}=b(),l=k(),[t,o]=f.useState({searchQuery:""}),j=R(),[d,u]=f.useState([]),n=d.filter(s=>Y(s.filename,t.searchQuery)),w=C(n.filter(s=>s.memo)),m=n.filter(s=>!s.memo);f.useEffect(()=>{h.listResources({}).then(({resources:s})=>{u(s),l.setFinish(),Promise.all(s.map(a=>a.memo?j.getOrFetchMemoByName(a.memo):null))})},[]);const y=async()=>{if(window.confirm("Are you sure to delete all unused resources? This action cannot be undone.")){for(const a of m)await h.deleteResource({name:a.name});u(d.filter(a=>a.memo))}};return e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:[!c&&e.jsx(T,{}),e.jsx("div",{className:"w-full px-4 sm:px-6",children:e.jsxs("div",{className:"w-full shadow flex flex-col justify-start items-start px-4 py-3 rounded-xl bg-white dark:bg-zinc-800 text-black dark:text-gray-300",children:[e.jsxs("div",{className:"relative w-full flex flex-row justify-between items-center",children:[e.jsxs("p",{className:"py-1 flex flex-row justify-start items-center select-none opacity-80",children:[e.jsx(S,{className:"w-6 h-auto mr-1 opacity-80"}),e.jsx("span",{className:"text-lg",children:r("common.resources")})]}),e.jsx("div",{children:e.jsx(D,{className:"max-w-[8rem]",placeholder:r("common.search"),startDecorator:e.jsx(E,{className:"w-4 h-auto"}),value:t.searchQuery,onChange:s=>o({...t,searchQuery:s.target.value})})})]}),e.jsx("div",{className:"w-full flex flex-col justify-start items-start mt-4 mb-6",children:l.isLoading?e.jsx("div",{className:"w-full h-32 flex flex-col justify-center items-center",children:e.jsx("p",{className:"w-full text-center text-base my-6 mt-8",children:r("resource.fetching-data")})}):e.jsx(e.Fragment,{children:n.length===0?e.jsxs("div",{className:"w-full mt-8 mb-8 flex flex-col justify-center items-center italic",children:[e.jsx(M,{}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:r("message.no-data")})]}):e.jsxs("div",{className:"w-full h-auto px-2 flex flex-col justify-start items-start gap-y-8",children:[Array.from(w.entries()).map(([s,a])=>e.jsxs("div",{className:"w-full flex flex-row justify-start items-start",children:[e.jsxs("div",{className:"w-16 sm:w-24 pt-4 sm:pl-4 flex flex-col justify-start items-start",children:[e.jsx("span",{className:"text-sm opacity-60",children:i(s).year()}),e.jsx("span",{className:"font-medium text-xl",children:i(s).toDate().toLocaleString(z.language,{month:"short"})})]}),e.jsx("div",{className:"w-full max-w-[calc(100%-4rem)] sm:max-w-[calc(100%-6rem)] flex flex-row justify-start items-start gap-4 flex-wrap",children:a.map(x=>e.jsxs("div",{className:"w-24 sm:w-32 h-auto flex flex-col justify-start items-start",children:[e.jsx("div",{className:"w-24 h-24 flex justify-center items-center sm:w-32 sm:h-32 border dark:border-zinc-900 overflow-clip rounded-xl cursor-pointer hover:shadow hover:opacity-80",children:e.jsx(p,{resource:x,strokeWidth:.5})}),e.jsx("div",{className:"w-full max-w-full flex flex-row justify-between items-center mt-1 px-1",children:e.jsx("p",{className:"text-xs shrink text-gray-400 truncate",children:x.filename})})]},x.name))})]},s)),m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(g,{}),e.jsxs("div",{className:"w-full flex flex-row justify-start items-start",children:[e.jsx("div",{className:"w-16 sm:w-24 sm:pl-4 flex flex-col justify-start items-start"}),e.jsxs("div",{className:"w-full max-w-[calc(100%-4rem)] sm:max-w-[calc(100%-6rem)] flex flex-row justify-start items-start gap-4 flex-wrap",children:[e.jsxs("div",{className:"w-full flex flex-row justify-start items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:r("resource.unused-resources")}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-500 opacity-80",children:["(",m.length,")"]}),e.jsx(N,{title:"Delete all",placement:"top",children:e.jsx(F,{size:"sm",variant:"plain",onClick:y,children:e.jsx(Q,{className:"w-4 h-auto opacity-60"})})})]}),m.map(s=>e.jsxs("div",{className:"w-24 sm:w-32 h-auto flex flex-col justify-start items-start",children:[e.jsx("div",{className:"w-24 h-24 flex justify-center items-center sm:w-32 sm:h-32 border dark:border-zinc-900 overflow-clip rounded-xl cursor-pointer hover:shadow hover:opacity-80",children:e.jsx(p,{resource:s,strokeWidth:.5})}),e.jsx("div",{className:"w-full max-w-full flex flex-row justify-between items-center mt-1 px-1",children:e.jsx("p",{className:"text-xs shrink text-gray-400 truncate",children:s.filename})})]},s.name))]})]})]})]})})})]})})]})};export{O as default};
