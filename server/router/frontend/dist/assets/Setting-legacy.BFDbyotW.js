System.register(["./mui-vendor-legacy.DYmTMD2B.js","./utils-vendor-legacy.4FVC2SsJ.js","./react-vendor-legacy.dIDhV_HT.js","./app-legacy.CVYr41OX.js","./external-link-legacy.ihruDLbr.js","./LocaleSelect-legacy.9T65N6EW.js","./mermaid-vendor-legacy.CXJ3QjYr.js","./highlight-vendor-legacy.CLg3VipY.js","./katex-vendor-legacy.C64AXX5g.js","./leaflet-vendor-legacy.DCz_1vRz.js"],(function(e,s){"use strict";var t,a,l,i,n,r,c,o,d,m,x,h,u,p,f,g,j,y,w,v,N,k,b,C,S,U,z,M,T,A,E,L,P,R,I,W,D,O,F,H,$,_,B,V,G,K,q,Y,Z,Q,X,J,ee,se,te,ae,le,ie,ne,re,ce,oe,de,me,xe,he,ue,pe,fe,ge;return{setters:[e=>{t=e.j,a=e.R,l=e.b,i=e.c,n=e.M,r=e.d,c=e.e,o=e.f,d=e.C,m=e.g,x=e.h,h=e.T,u=e.S,p=e.a,f=e.D,g=e.i,j=e.L,y=e.k},e=>{w=e.s,v=e.p,N=e.q,k=e.o},e=>{b=e.a,C=e.L,S=e.e},e=>{U=e.m,z=e.O,M=e.u,T=e.f,A=e.X,E=e.e,L=e.h,P=e.A,R=e.j,I=e.Q,W=e.W,D=e.S,O=e.Y,F=e.Z,H=e.w,$=e._,_=e.$,B=e.a0,V=e.U,G=e.a1,K=e.b,q=e.T,Y=e.B,Z=e.a2,Q=e.a3,X=e.a4,J=e.a5,ee=e.a6,se=e.a7,te=e.I,ae=e.a8,le=e.l,ie=e.y,ne=e.a9,re=e.aa,ce=e.ab,oe=e.ac,de=e.ad,me=e.o,xe=e.n,he=e.ae,ue=e.af},e=>{pe=e.E},e=>{fe=e.L,ge=e.A},null,null,null,null],execute:function(){
/**
       * @license lucide-react v0.453.0 - ISC
       *
       * This source code is licensed under the ISC license.
       * See the LICENSE file in the root directory of this source tree.
       */
const s=U("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),je=U("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),ye=U("Clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]),we=U("Cog",[["path",{d:"M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z",key:"sobvz5"}],["path",{d:"M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",key:"11i496"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 22v-2",key:"1osdcq"}],["path",{d:"m17 20.66-1-1.73",key:"eq3orb"}],["path",{d:"M11 10.27 7 3.34",key:"16pf9h"}],["path",{d:"m20.66 17-1.73-1",key:"sg0v6f"}],["path",{d:"m3.34 7 1.73 1",key:"1ulond"}],["path",{d:"M14 12h8",key:"4f43i9"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"m20.66 7-1.73 1",key:"1ow05n"}],["path",{d:"m3.34 17 1.73-1",key:"nuk764"}],["path",{d:"m17 3.34-1 1.73",key:"2wel8s"}],["path",{d:"m11 13.73-4 6.93",key:"794ttg"}]]),ve=U("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),Ne=U("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),ke=U("Library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]),be=U("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Ce=e=>{const{user:s,destroy:a}=e,l=M(),[i,n]=b.useState(""),[r,c]=b.useState("");b.useEffect((()=>{}),[]);const o=()=>{a()};return t.jsxs("div",{className:"max-w-full shadow flex flex-col justify-start items-start bg-white dark:bg-zinc-800 dark:text-gray-300 p-4 rounded-lg",children:[t.jsxs("div",{className:"flex flex-row justify-between items-center mb-4 gap-2 w-full",children:[t.jsxs("p",{children:[l("setting.account-section.change-password")," (",s.nickname,")"]}),t.jsx(T,{size:"sm",variant:"plain",onClick:o,children:t.jsx(A,{className:"w-5 h-auto"})})]}),t.jsxs("div",{className:"flex flex-col justify-start items-start !w-80",children:[t.jsx("p",{className:"text-sm mb-1",children:l("auth.new-password")}),t.jsx(E,{className:"w-full",type:"password",placeholder:l("auth.new-password"),value:i,onChange:e=>{const s=e.target.value;n(s)}}),t.jsx("p",{className:"text-sm mb-1 mt-2",children:l("auth.repeat-new-password")}),t.jsx(E,{className:"w-full",type:"password",placeholder:l("auth.repeat-new-password"),value:r,onChange:e=>{const s=e.target.value;c(s)}}),t.jsxs("div",{className:"flex flex-row justify-end items-center mt-4 w-full gap-x-2",children:[t.jsx(T,{variant:"plain",onClick:o,children:l("common.cancel")}),t.jsx(T,{color:"primary",onClick:async()=>{if(""!==i&&""!==r){if(i!==r)return L.error(l("message.new-password-not-match")),void c("");try{await P.updateUser({name:s.name,password:i},["password"]),L(l("message.password-changed")),o()}catch(e){console.error(e),L.error(e.details)}}else L.error(l("message.fill-all"))},children:l("common.save")})]})]})]})};
/**
       * @license lucide-react v0.453.0 - ISC
       *
       * This source code is licensed under the ISC license.
       * See the LICENSE file in the root directory of this source tree.
       */function Se(e){z({className:"change-member-password-dialog",dialogName:"change-member-password-dialog"},Ce,{user:e})}const Ue=()=>{const e=M(),s=R(),[o,d]=b.useState({creatingUser:I.fromPartial({username:"",password:"",role:W.USER})}),[m,x]=b.useState([]),h=w(m,"id");b.useEffect((()=>{u()}),[]);const u=async()=>{const e=await P.fetchUsers();x(e)};return t.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[t.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-500",children:e("setting.member-section.create-a-member")}),t.jsxs("div",{className:"w-auto flex flex-col justify-start items-start gap-2 border rounded-md py-2 px-3 dark:border-zinc-700",children:[t.jsxs("div",{className:"flex flex-col justify-start items-start gap-1",children:[t.jsx("span",{children:e("common.username")}),t.jsx(E,{type:"text",placeholder:e("common.username"),autoComplete:"off",value:o.creatingUser.username,onChange:e=>{d({...o,creatingUser:{...o.creatingUser,username:e.target.value}})}})]}),t.jsxs("div",{className:"flex flex-col justify-start items-start gap-1",children:[t.jsx("span",{children:e("common.password")}),t.jsx(E,{type:"password",placeholder:e("common.password"),autoComplete:"off",value:o.creatingUser.password,onChange:e=>{d({...o,creatingUser:{...o.creatingUser,password:e.target.value}})}})]}),t.jsxs("div",{className:"flex flex-col justify-start items-start gap-1",children:[t.jsx("span",{children:e("common.role")}),t.jsxs(a,{orientation:"horizontal",defaultValue:W.USER,onChange:e=>{d({...o,creatingUser:{...o.creatingUser,role:e.target.value}})},children:[t.jsx(l,{value:W.USER,label:e("setting.member-section.user")}),t.jsx(l,{value:W.ADMIN,label:e("setting.member-section.admin")})]})]}),t.jsx("div",{className:"mt-2",children:t.jsx(T,{color:"primary",onClick:async()=>{if(""!==o.creatingUser.username&&""!==o.creatingUser.password){try{await F.createUser({user:{username:o.creatingUser.username,password:o.creatingUser.password,role:o.creatingUser.role}})}catch(s){L.error(s.details)}await u(),d({...o,creatingUser:I.fromPartial({username:"",password:"",role:W.USER})})}else L.error(e("message.fill-all"))},children:e("common.create")})})]}),t.jsx("div",{className:"w-full flex flex-row justify-between items-center mt-6",children:t.jsx("div",{className:"title-text",children:e("setting.member-list")})}),t.jsx("div",{className:"w-full overflow-x-auto",children:t.jsx("div",{className:"inline-block min-w-full align-middle border rounded-lg dark:border-zinc-600",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-300 dark:divide-zinc-600",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"text-sm font-semibold text-left text-gray-900 dark:text-gray-400",children:[t.jsx("th",{scope:"col",className:"px-3 py-2",children:e("common.username")}),t.jsx("th",{scope:"col",className:"px-3 py-2",children:e("common.role")}),t.jsx("th",{scope:"col",className:"px-3 py-2",children:e("common.nickname")}),t.jsx("th",{scope:"col",className:"px-3 py-2",children:e("common.email")}),t.jsx("th",{scope:"col",className:"relative py-2 pl-3 pr-4"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-zinc-600",children:h.map((a=>{return t.jsxs("tr",{children:[t.jsxs("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-500 dark:text-gray-400",children:[a.username,t.jsx("span",{className:"ml-1 italic",children:a.state===D.ARCHIVED&&"(Archived)"})]}),t.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-500 dark:text-gray-400",children:(l=a.role,l===W.HOST?"Host":l===W.ADMIN?e("setting.member-section.admin"):e("setting.member-section.user"))}),t.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-500 dark:text-gray-400",children:a.nickname}),t.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-500 dark:text-gray-400",children:a.email}),t.jsx("td",{className:"relative whitespace-nowrap py-2 pl-3 pr-4 text-right text-sm font-medium flex justify-end",children:s?.name===a.name?t.jsx("span",{children:e("common.yourself")}):t.jsxs(i,{children:[t.jsx(n,{size:"sm",children:t.jsx(O,{className:"w-4 h-auto"})}),t.jsxs(r,{placement:"bottom-end",size:"sm",children:[t.jsx(c,{onClick:()=>(e=>{Se(e)})(a),children:e("setting.account-section.change-password")}),a.state===D.NORMAL?t.jsx(c,{onClick:()=>(async s=>{window.confirm(e("setting.member-section.archive-warning",{username:s.nickname}))&&(await F.updateUser({user:{name:s.name,state:D.ARCHIVED},updateMask:["state"]}),u())})(a),children:e("setting.member-section.archive-member")}):t.jsxs(t.Fragment,{children:[t.jsx(c,{onClick:()=>(async e=>{await F.updateUser({user:{name:e.name,state:D.NORMAL},updateMask:["state"]}),u()})(a),children:e("common.restore")}),t.jsx(c,{onClick:()=>(async s=>{window.confirm(e("setting.member-section.delete-warning",{username:s.nickname}))&&(await P.deleteUser(s.name),u())})(a),children:e("setting.member-section.delete-member")})]})]})]})})]},a.name);var l}))})]})})})]})},ze=()=>{const e=M(),a=H.state.memoRelatedSetting,[l,i]=b.useState(a),[n,r]=b.useState(""),[c,x]=b.useState(""),h=e=>{const s=$.fromPartial({...l,...e});i(s)};return t.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[t.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-500",children:e("setting.memo-related-settings.title")}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{children:e("setting.system-section.disable-public-memos")}),t.jsx(o,{checked:l.disallowPublicVisibility,onChange:e=>h({disallowPublicVisibility:e.target.checked})})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{children:e("setting.system-section.display-with-updated-time")}),t.jsx(o,{checked:l.displayWithUpdateTime,onChange:e=>h({displayWithUpdateTime:e.target.checked})})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{children:e("setting.memo-related-settings.enable-link-preview")}),t.jsx(o,{checked:l.enableLinkPreview,onChange:e=>h({enableLinkPreview:e.target.checked})})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{children:e("setting.memo-related-settings.enable-memo-comments")}),t.jsx(o,{checked:l.enableComment,onChange:e=>h({enableComment:e.target.checked})})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{children:e("setting.memo-related-settings.enable-memo-location")}),t.jsx(o,{checked:l.enableLocation,onChange:e=>h({enableLocation:e.target.checked})})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{children:e("setting.system-section.enable-double-click-to-edit")}),t.jsx(o,{checked:l.enableDoubleClickEdit,onChange:e=>h({enableDoubleClickEdit:e.target.checked})})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{children:e("setting.system-section.disable-markdown-shortcuts-in-editor")}),t.jsx(o,{checked:l.disableMarkdownShortcuts,onChange:e=>h({disableMarkdownShortcuts:e.target.checked})})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{children:e("setting.memo-related-settings.content-lenght-limit")}),t.jsx(E,{className:"w-24",type:"number",defaultValue:l.contentLengthLimit,onBlur:e=>h({contentLengthLimit:Number(e.target.value)})})]}),t.jsxs("div",{className:"w-full",children:[t.jsx("span",{className:"truncate",children:e("setting.memo-related-settings.reactions")}),t.jsxs("div",{className:"mt-2 w-full flex flex-row flex-wrap gap-1",children:[l.reactions.map((e=>t.jsx(d,{className:"!h-8",variant:"outlined",size:"lg",endDecorator:t.jsx(m,{onDelete:()=>h({reactions:l.reactions.filter((s=>s!==e))})}),children:e},e))),t.jsx(E,{className:"w-32 !rounded-full !pl-3",placeholder:e("common.input"),size:"sm",value:n,onChange:e=>r(e.target.value.trim()),endDecorator:t.jsx(s,{className:"w-5 h-5 text-gray-500 dark:text-gray-400 cursor-pointer hover:text-teal-600",onClick:()=>{n&&(h({reactions:N([...l.reactions,n.trim()])}),r(""))}})})]})]}),t.jsxs("div",{className:"w-full",children:[t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{children:e("setting.memo-related-settings.enable-blur-nsfw-content")}),t.jsx(o,{checked:l.enableBlurNsfwContent,onChange:e=>h({enableBlurNsfwContent:e.target.checked})})]}),t.jsxs("div",{className:"mt-2 w-full flex flex-row flex-wrap gap-1",children:[l.nsfwTags.map((e=>t.jsx(d,{className:"!h-8",variant:"outlined",size:"lg",endDecorator:t.jsx(m,{onDelete:()=>h({nsfwTags:l.nsfwTags.filter((s=>s!==e))})}),children:e},e))),t.jsx(E,{className:"w-32 !rounded-full !pl-3",placeholder:e("common.input"),size:"sm",value:c,onChange:e=>x(e.target.value.trim()),endDecorator:t.jsx(s,{className:"w-5 h-5 text-gray-500 dark:text-gray-400 cursor-pointer hover:text-teal-600",onClick:()=>{c&&(h({nsfwTags:N([...l.nsfwTags,c.trim()])}),x(""))}})})]})]}),t.jsx("div",{className:"mt-2 w-full flex justify-end",children:t.jsx(T,{color:"primary",disabled:v(l,a),onClick:async()=>{if(0!==l.reactions.length){try{await H.upsertWorkspaceSetting({name:`${_}${B.MEMO_RELATED}`,memoRelatedSetting:l})}catch(s){return L.error(s.details),void console.error(s)}L.success(e("message.update-succeed"))}else L.error("Reactions must not be empty.")},children:e("common.save")})})]})},Me=({destroy:e})=>{const s=M(),a=R(),[l,i]=b.useState({avatarUrl:a.avatarUrl,username:a.username,nickname:a.nickname,email:a.email,description:a.description}),n=H.state.generalSetting,r=()=>{e()},c=e=>{i((s=>({...s,...e})))};return t.jsxs("div",{className:"max-w-full shadow flex flex-col justify-start items-start bg-white dark:bg-zinc-800 dark:text-gray-300 p-4 rounded-lg",children:[t.jsxs("div",{className:"flex flex-row justify-between items-center mb-4 gap-2 w-full",children:[t.jsx("p",{className:"title-text",children:s("setting.account-section.update-information")}),t.jsx(T,{size:"sm",variant:"plain",onClick:r,children:t.jsx(A,{className:"w-5 h-auto"})})]}),t.jsxs("div",{className:"flex flex-col justify-start items-start !w-64 space-y-2",children:[t.jsxs("div",{className:"w-full flex flex-row justify-start items-center",children:[t.jsx("span",{className:"text-sm mr-2",children:s("common.avatar")}),t.jsxs("label",{className:"relative cursor-pointer hover:opacity-80",children:[t.jsx(V,{className:"!w-10 !h-10",avatarUrl:l.avatarUrl}),t.jsx("input",{type:"file",accept:"image/*",className:"absolute invisible w-full h-full inset-0",onChange:async e=>{const s=e.target.files;if(s&&s.length>0){const e=s[0];if(e.size>2097152)return void L.error("Max file size is 2MB");try{const s=await G(e);c({avatarUrl:s})}catch(t){console.error(t),L.error("Failed to convert image to base64")}}}})]}),l.avatarUrl&&t.jsx(A,{className:"w-4 h-auto ml-1 cursor-pointer opacity-60 hover:opacity-80",onClick:()=>c({avatarUrl:""})})]}),t.jsxs("p",{className:"text-sm",children:[s("common.username"),t.jsxs("span",{className:"text-sm text-gray-400 ml-1",children:["(",s("setting.account-section.username-note"),")"]})]}),t.jsx(E,{className:"w-full",value:l.username,onChange:e=>{c({username:e.target.value})},disabled:n.disallowChangeUsername}),t.jsxs("p",{className:"text-sm",children:[s("common.nickname"),t.jsxs("span",{className:"text-sm text-gray-400 ml-1",children:["(",s("setting.account-section.nickname-note"),")"]})]}),t.jsx(E,{className:"w-full",value:l.nickname,onChange:e=>{c({nickname:e.target.value})},disabled:n.disallowChangeNickname}),t.jsxs("p",{className:"text-sm",children:[s("common.email"),t.jsxs("span",{className:"text-sm text-gray-400 ml-1",children:["(",s("setting.account-section.email-note"),")"]})]}),t.jsx(E,{fullWidth:!0,type:"email",value:l.email,onChange:e=>{i((s=>({...s,email:e.target.value})))}}),t.jsx("p",{className:"text-sm",children:s("common.description")}),t.jsx(x,{className:"w-full",color:"neutral",minRows:2,maxRows:4,value:l.description,onChange:e=>{i((s=>({...s,description:e.target.value})))}}),t.jsxs("div",{className:"w-full flex flex-row justify-end items-center pt-4 space-x-2",children:[t.jsx(T,{variant:"plain",onClick:r,children:s("common.cancel")}),t.jsx(T,{color:"primary",onClick:async()=>{if(""!==l.username)try{const e=[];v(a.username,l.username)||e.push("username"),v(a.nickname,l.nickname)||e.push("nickname"),v(a.email,l.email)||e.push("email"),v(a.avatarUrl,l.avatarUrl)||e.push("avatar_url"),v(a.description,l.description)||e.push("description"),await P.updateUser(I.fromPartial({name:a.name,username:l.username,nickname:l.nickname,email:l.email,avatarUrl:l.avatarUrl,description:l.description}),e),L.success(s("message.update-succeed")),r()}catch(e){console.error(e),L.error(e.details)}else L.error(s("message.fill-all"))},children:s("common.save")})]})]})]})};function Te(){z({className:"update-account-dialog",dialogName:"update-account-dialog"},Me)}const Ae=e=>{const{destroy:s,onConfirm:i}=e,n=M(),r=R(),[c,o]=b.useState({description:"",expiration:28800}),d=K(!1),m=[{label:n("setting.access-token-section.create-dialog.duration-8h"),value:28800},{label:n("setting.access-token-section.create-dialog.duration-1m"),value:2592e3},{label:n("setting.access-token-section.create-dialog.duration-never"),value:0}],x=e=>{o({...c,...e})};return t.jsxs("div",{className:"max-w-full shadow flex flex-col justify-start items-start bg-white dark:bg-zinc-800 dark:text-gray-300 p-4 rounded-lg",children:[t.jsxs("div",{className:"flex flex-row justify-between items-center w-full mb-4 gap-2",children:[t.jsx("p",{children:n("setting.access-token-section.create-dialog.create-access-token")}),t.jsx(T,{size:"sm",variant:"plain",onClick:()=>s(),children:t.jsx(A,{className:"w-5 h-auto"})})]}),t.jsxs("div",{className:"flex flex-col justify-start items-start !w-80",children:[t.jsxs("div",{className:"w-full flex flex-col justify-start items-start mb-3",children:[t.jsxs("span",{className:"mb-2",children:[n("setting.access-token-section.create-dialog.description")," ",t.jsx("span",{className:"text-red-600",children:"*"})]}),t.jsx("div",{className:"relative w-full",children:t.jsx(E,{className:"w-full",type:"text",placeholder:n("setting.access-token-section.create-dialog.some-description"),value:c.description,onChange:e=>{x({description:e.target.value})}})})]}),t.jsxs("div",{className:"w-full flex flex-col justify-start items-start mb-3",children:[t.jsxs("span",{className:"mb-2",children:[n("setting.access-token-section.create-dialog.expiration")," ",t.jsx("span",{className:"text-red-600",children:"*"})]}),t.jsx("div",{className:"w-full flex flex-row justify-start items-center text-base",children:t.jsx(a,{orientation:"horizontal",value:c.expiration,onChange:e=>{x({expiration:Number(e.target.value)})},children:m.map((e=>t.jsx(l,{value:e.value,checked:c.expiration===e.value,label:e.label},e.value)))})})]}),t.jsxs("div",{className:"w-full flex flex-row justify-end items-center mt-4 space-x-2",children:[t.jsx(T,{variant:"plain",disabled:d.isLoading,onClick:s,children:n("common.cancel")}),t.jsx(T,{color:"primary",disabled:d.isLoading,onClick:async()=>{if(c.description)try{await F.createUserAccessToken({name:r.name,description:c.description,expiresAt:c.expiration?new Date(Date.now()+1e3*c.expiration):void 0}),i(),s()}catch(e){L.error(e.details),console.error(e)}else L.error(n("message.description-is-required"))},children:n("common.create")})]})]})]})},Ee=e=>{const{className:s,url:a,title:l}=e,i=M();return t.jsx(h,{title:l??i("common.learn-more"),placement:"top",children:t.jsx("a",{className:`text-gray-500 dark:text-gray-400 hover:text-blue-600 ${s}`,href:a,target:"_blank",children:t.jsx(pe,{className:"w-4 h-auto"})})})},Le=async e=>{const{accessTokens:s}=await F.listUserAccessTokens({name:e});return s.sort(((e,s)=>(s.issuedAt?.getTime()??0)-(e.issuedAt?.getTime()??0)))},Pe=()=>{const e=M(),s=R(),[a,l]=b.useState([]);b.useEffect((()=>{Le(s.name).then((e=>{l(e)}))}),[]);const i=async()=>{const e=await Le(s.name);l(e)},n=e=>`${e.slice(0,4)}****${e.slice(-4)}`;return t.jsx("div",{className:"mt-6 w-full flex flex-col justify-start items-start space-y-4",children:t.jsxs("div",{className:"w-full",children:[t.jsxs("div",{className:"sm:flex sm:items-center sm:justify-between",children:[t.jsxs("div",{className:"sm:flex-auto space-y-1",children:[t.jsxs("p",{className:"flex flex-row justify-start items-center font-medium text-gray-700 dark:text-gray-400",children:[e("setting.access-token-section.title"),t.jsx(Ee,{className:"ml-2",url:"https://usememos.com/docs/security/access-tokens"})]}),t.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-500",children:e("setting.access-token-section.description")})]}),t.jsx("div",{className:"mt-4 sm:mt-0",children:t.jsx(T,{color:"primary",onClick:()=>{z({className:"create-access-token-dialog",dialogName:"create-access-token-dialog"},Ae,{onConfirm:i})},children:e("common.create")})})]}),t.jsx("div",{className:"w-full mt-2 flow-root",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsx("div",{className:"inline-block min-w-full border rounded-lg align-middle dark:border-zinc-600",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-300 dark:divide-zinc-600",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-gray-900 dark:text-gray-400",children:e("setting.access-token-section.token")}),t.jsx("th",{scope:"col",className:"py-2 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 dark:text-gray-400",children:e("common.description")}),t.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-gray-900 dark:text-gray-400",children:e("setting.access-token-section.create-dialog.created-at")}),t.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-gray-900 dark:text-gray-400",children:e("setting.access-token-section.create-dialog.expires-at")}),t.jsx("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4",children:t.jsx("span",{className:"sr-only",children:e("common.delete")})})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-zinc-700",children:a.map((i=>t.jsxs("tr",{children:[t.jsxs("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-900 dark:text-gray-400 flex flex-row justify-start items-center gap-x-1",children:[t.jsx("span",{className:"font-mono",children:n(i.accessToken)}),t.jsx(T,{variant:"plain",size:"sm",onClick:()=>{return s=i.accessToken,Y(s),void L.success(e("setting.access-token-section.access-token-copied-to-clipboard"));var s},children:t.jsx(ye,{className:"w-4 h-auto text-gray-400"})})]}),t.jsx("td",{className:"whitespace-nowrap py-2 pl-4 pr-3 text-sm text-gray-900 dark:text-gray-400",children:i.description}),t.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-500 dark:text-gray-400",children:i.issuedAt?.toLocaleString()}),t.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-500 dark:text-gray-400",children:i.expiresAt?.toLocaleString()??e("setting.access-token-section.create-dialog.duration-never")}),t.jsx("td",{className:"relative whitespace-nowrap py-2 pl-3 pr-4 text-right text-sm",children:t.jsx(T,{variant:"plain",size:"sm",onClick:()=>{(async t=>{const i=n(t);window.confirm(e("setting.access-token-section.access-token-deletion",{accessToken:i}))&&(await F.deleteUserAccessToken({name:s.name,accessToken:t}),l(a.filter((e=>e.accessToken!==t))))})(i.accessToken)},children:t.jsx(q,{className:"text-red-600 w-4 h-auto"})})})]},i.accessToken)))})]})})})})]})})},Re=()=>{const e=M(),s=R();return t.jsxs("div",{className:"w-full gap-2 pt-2 pb-4",children:[t.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-500",children:e("setting.account-section.title")}),t.jsxs("div",{className:"w-full mt-2 flex flex-row justify-start items-center",children:[t.jsx(V,{className:"mr-2 shrink-0 w-10 h-10",avatarUrl:s.avatarUrl}),t.jsxs("div",{className:"max-w-[calc(100%-3rem)] flex flex-col justify-center items-start",children:[t.jsxs("p",{className:"w-full",children:[t.jsx("span",{className:"text-xl leading-tight font-medium",children:s.nickname}),t.jsxs("span",{className:"ml-1 text-base leading-tight text-gray-500 dark:text-gray-400",children:["(",s.username,")"]})]}),t.jsx("p",{className:"w-4/5 leading-tight text-sm truncate",children:s.description})]})]}),t.jsxs("div",{className:"w-full flex flex-row justify-start items-center mt-2 space-x-2",children:[t.jsxs(T,{variant:"outlined",size:"sm",onClick:Te,children:[t.jsx(Z,{className:"w-4 h-4 mx-auto mr-1"}),e("common.edit")]}),t.jsxs(i,{children:[t.jsx(n,{slots:{root:"div"},children:t.jsx(T,{variant:"outlined",size:"sm",children:t.jsx(O,{className:"w-4 h-4 mx-auto"})})}),t.jsx(r,{className:"text-sm",size:"sm",placement:"bottom",children:t.jsx(c,{onClick:()=>Se(s),children:e("setting.account-section.change-password")})})]})]}),t.jsx(Pe,{})]})},Ie=e=>{const{webhookId:s,destroy:a,onConfirm:l}=e,i=M(),[n,r]=b.useState({name:"",url:""}),c=K(!1),o=void 0===s;b.useEffect((()=>{s&&Q.getWebhook({id:s}).then((e=>{r({name:e.name,url:e.url})}))}),[]);const d=e=>{r({...n,...e})};return t.jsxs("div",{className:"max-w-full shadow flex flex-col justify-start items-start bg-white dark:bg-zinc-800 dark:text-gray-300 p-4 rounded-lg",children:[t.jsxs("div",{className:"flex flex-row justify-between items-center mb-4 gap-2 w-full",children:[t.jsx("p",{className:"title-text",children:i(o?"setting.webhook-section.create-dialog.create-webhook":"setting.webhook-section.create-dialog.edit-webhook")}),t.jsx(T,{size:"sm",variant:"plain",onClick:()=>a(),children:t.jsx(A,{className:"w-5 h-auto"})})]}),t.jsxs("div",{className:"flex flex-col justify-start items-start !w-80",children:[t.jsxs("div",{className:"w-full flex flex-col justify-start items-start mb-3",children:[t.jsxs("span",{className:"mb-2",children:[i("setting.webhook-section.create-dialog.title")," ",t.jsx("span",{className:"text-red-600",children:"*"})]}),t.jsx("div",{className:"relative w-full",children:t.jsx(E,{className:"w-full",type:"text",placeholder:i("setting.webhook-section.create-dialog.an-easy-to-remember-name"),value:n.name,onChange:e=>{d({name:e.target.value})}})})]}),t.jsxs("div",{className:"w-full flex flex-col justify-start items-start mb-3",children:[t.jsxs("span",{className:"mb-2",children:[i("setting.webhook-section.create-dialog.payload-url")," ",t.jsx("span",{className:"text-red-600",children:"*"})]}),t.jsx("div",{className:"relative w-full",children:t.jsx(E,{className:"w-full",type:"text",placeholder:i("setting.webhook-section.create-dialog.url-example-post-receive"),value:n.url,onChange:e=>{d({url:e.target.value})}})})]}),t.jsxs("div",{className:"w-full flex flex-row justify-end items-center mt-2 space-x-2",children:[t.jsx(T,{variant:"plain",disabled:c.isLoading,onClick:a,children:i("common.cancel")}),t.jsx(T,{color:"primary",disabled:c.isLoading,onClick:async()=>{if(n.name&&n.url)try{o?await Q.createWebhook({name:n.name,url:n.url}):await Q.updateWebhook({webhook:{id:s,name:n.name,url:n.url},updateMask:["name","url"]}),l(),a()}catch(e){console.error(e),L.error(e.details)}else L.error(i("message.fill-all-required-fields"))},children:i("common.create")})]})]})]})},We=async e=>{const{webhooks:s}=await Q.listWebhooks({creator:e});return s},De=()=>{const e=M(),s=R(),[a,l]=b.useState([]);b.useEffect((()=>{We(s.name).then((e=>{l(e)}))}),[]);const i=async()=>{const e=await We(s.name);l(e)};return t.jsxs("div",{className:"w-full flex flex-col justify-start items-start",children:[t.jsxs("div",{className:"w-full flex justify-between items-center",children:[t.jsx("div",{className:"flex-auto space-y-1",children:t.jsx("p",{className:"flex flex-row justify-start items-center font-medium text-gray-700 dark:text-gray-400",children:e("setting.webhook-section.title")})}),t.jsx("div",{children:t.jsx(T,{color:"primary",onClick:()=>{z({className:"create-webhook-dialog",dialogName:"create-webhook-dialog"},Ie,{onConfirm:i})},children:e("common.create")})})]}),t.jsx("div",{className:"w-full mt-2 flow-root",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsx("div",{className:"inline-block min-w-full border rounded-lg align-middle dark:border-zinc-600",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-300 dark:divide-zinc-600",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-gray-900 dark:text-gray-400",children:e("common.name")}),t.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-gray-900 dark:text-gray-400",children:e("setting.webhook-section.url")}),t.jsx("th",{scope:"col",className:"relative px-3 py-2 pr-4",children:t.jsx("span",{className:"sr-only",children:e("common.delete")})})]})}),t.jsxs("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-500",children:[a.map((e=>t.jsxs("tr",{children:[t.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-900 dark:text-gray-400",children:e.name}),t.jsx("td",{className:"max-w-[200px] px-3 py-2 text-sm text-gray-900 dark:text-gray-400 truncate",title:e.url,children:e.url}),t.jsx("td",{className:"relative whitespace-nowrap px-3 py-2 text-right text-sm",children:t.jsx(T,{variant:"plain",size:"sm",onClick:()=>{(async e=>{window.confirm(`Are you sure to delete webhook \`${e.name}\`? You cannot undo this action.`)&&(await Q.deleteWebhook({id:e.id}),l(a.filter((s=>s.id!==e.id))))})(e)},children:t.jsx(q,{className:"text-red-600 w-4 h-auto"})})})]},e.id))),0===a.length&&t.jsx("tr",{children:t.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-gray-900 dark:text-gray-400",colSpan:3,children:e("setting.webhook-section.no-webhooks-found")})})]})]})})})}),t.jsx("div",{className:"w-full mt-2",children:t.jsxs(C,{className:"text-gray-500 text-sm inline-flex flex-row justify-start items-center hover:underline hover:text-blue-600",to:"https://usememos.com/docs/advanced-settings/webhook",target:"_blank",children:[e("common.learn-more"),t.jsx(pe,{className:"inline w-4 h-auto ml-1"})]})})]})},Oe=k((()=>{const e=M(),s=P.state.userSetting;return t.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[t.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-500",children:e("common.basic")}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{children:e("common.language")}),t.jsx(fe,{value:s.locale,onChange:async e=>{await P.updateUserSetting({locale:e},["locale"])}})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{children:e("setting.preference-section.theme")}),t.jsx(ge,{value:s.appearance,onChange:async e=>{await P.updateUserSetting({appearance:e},["appearance"])}})]}),t.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-500",children:e("setting.preference")}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{className:"truncate",children:e("setting.preference-section.default-memo-visibility")}),t.jsx(u,{className:"!min-w-fit",value:s.memoVisibility,startDecorator:t.jsx(ee,{visibility:se(s.memoVisibility)}),onChange:(e,s)=>{s&&(async e=>{await P.updateUserSetting({memoVisibility:e},["memo_visibility"])})(s)},children:[X.PRIVATE,X.PROTECTED,X.PUBLIC].map((e=>J(e))).map((s=>t.jsx(p,{value:s,className:"whitespace-nowrap",children:e(`memo.visibility.${s.toLowerCase()}`)},s)))})]}),t.jsx(f,{className:"!my-3"}),t.jsx(De,{})]})})),Fe=[{name:"",title:"GitHub",type:te.OAUTH2,identifierFilter:"",config:{oauth2Config:{clientId:"",clientSecret:"",authUrl:"https://github.com/login/oauth/authorize",tokenUrl:"https://github.com/login/oauth/access_token",userInfoUrl:"https://api.github.com/user",scopes:["read:user"],fieldMapping:{identifier:"login",displayName:"name",email:"email"}}}},{name:"",title:"GitLab",type:te.OAUTH2,identifierFilter:"",config:{oauth2Config:{clientId:"",clientSecret:"",authUrl:"https://gitlab.com/oauth/authorize",tokenUrl:"https://gitlab.com/oauth/token",userInfoUrl:"https://gitlab.com/oauth/userinfo",scopes:["openid"],fieldMapping:{identifier:"name",displayName:"name",email:"email"}}}},{name:"",title:"Google",type:te.OAUTH2,identifierFilter:"",config:{oauth2Config:{clientId:"",clientSecret:"",authUrl:"https://accounts.google.com/o/oauth2/v2/auth",tokenUrl:"https://oauth2.googleapis.com/token",userInfoUrl:"https://www.googleapis.com/oauth2/v2/userinfo",scopes:["https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/userinfo.profile"],fieldMapping:{identifier:"email",displayName:"name",email:"email"}}}},{name:"",title:"Custom",type:te.OAUTH2,identifierFilter:"",config:{oauth2Config:{clientId:"",clientSecret:"",authUrl:"",tokenUrl:"",userInfoUrl:"",scopes:[],fieldMapping:{identifier:"",displayName:"",email:""}}}}],He=e=>{const s=M(),a=[...new Set(Fe.map((e=>e.type)))],{confirmCallback:l,destroy:i,identityProvider:n}=e,[r,c]=b.useState({title:"",identifierFilter:""}),[o,d]=b.useState(te.OAUTH2),[m,x]=b.useState({clientId:"",clientSecret:"",authUrl:"",tokenUrl:"",userInfoUrl:"",scopes:[],fieldMapping:{identifier:"",displayName:"",email:""}}),[h,j]=b.useState(""),[y,w]=b.useState("GitHub"),v=void 0===n;b.useEffect((()=>{if(n&&(c({title:n.title,identifierFilter:n.identifierFilter}),d(n.type),n.type===te.OAUTH2)){const e=ae.fromPartial(n.config?.oauth2Config||{});x(e),j(e.scopes.join(" "))}}),[]),b.useEffect((()=>{if(!v)return;const e=Fe.find((e=>e.title===y));if(e&&(c({title:e.title,identifierFilter:e.identifierFilter}),d(e.type),e.type===te.OAUTH2)){const s=ae.fromPartial(e.config?.oauth2Config||{});x(s),j(s.scopes.join(" "))}}),[y]);const N=()=>{i()},k=e=>{x({...m,...e})};return t.jsxs("div",{className:"max-w-full shadow flex flex-col justify-start items-start bg-white dark:bg-zinc-800 dark:text-gray-300 p-4 rounded-lg",children:[t.jsxs("div",{className:"flex flex-row justify-between items-center mb-4 gap-2 w-full",children:[t.jsx("p",{children:s(v?"setting.sso-section.create-sso":"setting.sso-section.update-sso")}),t.jsx(T,{size:"sm",variant:"plain",onClick:N,children:t.jsx(A,{className:"w-5 h-auto"})})]}),t.jsxs("div",{className:"flex flex-col justify-start items-start w-80",children:[v&&t.jsxs(t.Fragment,{children:[t.jsx(g,{className:"!mb-1",level:"body-md",children:s("common.type")}),t.jsx(u,{className:"w-full mb-4",value:o,onChange:(e,s)=>d(s??o),children:a.map((e=>t.jsx(p,{value:e,children:e},e)))}),t.jsx(g,{className:"mb-2",level:"body-md",children:s("setting.sso-section.template")}),t.jsx(u,{className:"mb-1 h-auto w-full",value:y,onChange:(e,s)=>w(s??y),children:Fe.map((e=>t.jsx(p,{value:e.title,children:e.title},e.title)))}),t.jsx(f,{className:"!my-2"})]}),t.jsxs(g,{className:"!mb-1",level:"body-md",children:[s("common.name"),t.jsx("span",{className:"text-red-600",children:"*"})]}),t.jsx(E,{className:"mb-2",placeholder:s("common.name"),value:r.title,onChange:e=>c({...r,title:e.target.value}),fullWidth:!0}),t.jsx(g,{className:"!mb-1",level:"body-md",children:s("setting.sso-section.identifier-filter")}),t.jsx(E,{className:"mb-2",placeholder:s("setting.sso-section.identifier-filter"),value:r.identifierFilter,onChange:e=>c({...r,identifierFilter:e.target.value}),fullWidth:!0}),t.jsx(f,{className:"!my-2"}),"OAUTH2"===o&&t.jsxs(t.Fragment,{children:[v&&t.jsxs("p",{className:"border rounded-md p-2 text-sm w-full mb-2 break-all",children:[s("setting.sso-section.redirect-url"),": ",le("/auth/callback")]}),t.jsxs(g,{className:"!mb-1",level:"body-md",children:[s("setting.sso-section.client-id"),t.jsx("span",{className:"text-red-600",children:"*"})]}),t.jsx(E,{className:"mb-2",placeholder:s("setting.sso-section.client-id"),value:m.clientId,onChange:e=>k({clientId:e.target.value}),fullWidth:!0}),t.jsxs(g,{className:"!mb-1",level:"body-md",children:[s("setting.sso-section.client-secret"),t.jsx("span",{className:"text-red-600",children:"*"})]}),t.jsx(E,{className:"mb-2",placeholder:s("setting.sso-section.client-secret"),value:m.clientSecret,onChange:e=>k({clientSecret:e.target.value}),fullWidth:!0}),t.jsxs(g,{className:"!mb-1",level:"body-md",children:[s("setting.sso-section.authorization-endpoint"),t.jsx("span",{className:"text-red-600",children:"*"})]}),t.jsx(E,{className:"mb-2",placeholder:s("setting.sso-section.authorization-endpoint"),value:m.authUrl,onChange:e=>k({authUrl:e.target.value}),fullWidth:!0}),t.jsxs(g,{className:"!mb-1",level:"body-md",children:[s("setting.sso-section.token-endpoint"),t.jsx("span",{className:"text-red-600",children:"*"})]}),t.jsx(E,{className:"mb-2",placeholder:s("setting.sso-section.token-endpoint"),value:m.tokenUrl,onChange:e=>k({tokenUrl:e.target.value}),fullWidth:!0}),t.jsxs(g,{className:"!mb-1",level:"body-md",children:[s("setting.sso-section.user-endpoint"),t.jsx("span",{className:"text-red-600",children:"*"})]}),t.jsx(E,{className:"mb-2",placeholder:s("setting.sso-section.user-endpoint"),value:m.userInfoUrl,onChange:e=>k({userInfoUrl:e.target.value}),fullWidth:!0}),t.jsxs(g,{className:"!mb-1",level:"body-md",children:[s("setting.sso-section.scopes"),t.jsx("span",{className:"text-red-600",children:"*"})]}),t.jsx(E,{className:"mb-2",placeholder:s("setting.sso-section.scopes"),value:h,onChange:e=>j(e.target.value),fullWidth:!0}),t.jsx(f,{className:"!my-2"}),t.jsxs(g,{className:"!mb-1",level:"body-md",children:[s("setting.sso-section.identifier"),t.jsx("span",{className:"text-red-600",children:"*"})]}),t.jsx(E,{className:"mb-2",placeholder:s("setting.sso-section.identifier"),value:m.fieldMapping.identifier,onChange:e=>k({fieldMapping:{...m.fieldMapping,identifier:e.target.value}}),fullWidth:!0}),t.jsx(g,{className:"!mb-1",level:"body-md",children:s("setting.sso-section.display-name")}),t.jsx(E,{className:"mb-2",placeholder:s("setting.sso-section.display-name"),value:m.fieldMapping.displayName,onChange:e=>k({fieldMapping:{...m.fieldMapping,displayName:e.target.value}}),fullWidth:!0}),t.jsx(g,{className:"!mb-1",level:"body-md",children:s("common.email")}),t.jsx(E,{className:"mb-2",placeholder:s("common.email"),value:m.fieldMapping.email,onChange:e=>k({fieldMapping:{...m.fieldMapping,email:e.target.value}}),fullWidth:!0})]}),t.jsxs("div",{className:"mt-2 w-full flex flex-row justify-end items-center space-x-1",children:[t.jsx(T,{variant:"plain",onClick:N,children:s("common.cancel")}),t.jsx(T,{color:"primary",onClick:async()=>{try{v?(await ie.createIdentityProvider({identityProvider:{...r,type:o,config:{oauth2Config:{...m,scopes:h.split(" ")}}}}),L.success(s("setting.sso-section.sso-created",{name:r.title}))):(await ie.updateIdentityProvider({identityProvider:{...r,name:n.name,type:o,config:{oauth2Config:{...m,scopes:h.split(" ")}}},updateMask:["title","identifier_filter","config"]}),L.success(s("setting.sso-section.sso-updated",{name:r.title})))}catch(e){L.error(e.details),console.error(e)}l&&l(),i()},disabled:!(()=>{if(""===r.title)return!1;if("OAUTH2"===o){if(""===m.clientId||""===m.authUrl||""===m.tokenUrl||""===m.userInfoUrl||""===h||""===m.fieldMapping?.identifier)return!1;if(v&&""===m.clientSecret)return!1}return!0})(),children:s(v?"common.create":"common.update")})]})]})]})};function $e(e,s){z({className:"create-identity-provider-dialog",dialogName:"create-identity-provider-dialog"},He,{identityProvider:e,confirmCallback:s})}const _e=()=>{const e=M(),[s,a]=b.useState([]);b.useEffect((()=>{l()}),[]);const l=async()=>{const{identityProviders:e}=await ie.listIdentityProviders({});a(e)};return t.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[t.jsxs("div",{className:"w-full flex flex-row justify-between items-center gap-1",children:[t.jsxs("div",{className:"flex flex-row items-center gap-1",children:[t.jsx("span",{className:"font-mono text-gray-400",children:e("setting.sso-section.sso-list")}),t.jsx(Ee,{url:"https://www.usememos.com/docs/advanced-settings/sso"})]}),t.jsx(T,{color:"primary",onClick:()=>$e(void 0,l),children:e("common.create")})]}),t.jsx(f,{}),s.map((s=>t.jsxs("div",{className:"py-2 w-full border-b last:border-b dark:border-zinc-700 flex flex-row items-center justify-between",children:[t.jsx("div",{className:"flex flex-row items-center",children:t.jsxs("p",{className:"ml-2",children:[s.title,t.jsxs("span",{className:"text-sm ml-1 opacity-40",children:["(",s.type,")"]})]})}),t.jsx("div",{className:"flex flex-row items-center",children:t.jsxs(i,{children:[t.jsx(n,{size:"sm",children:t.jsx(O,{className:"w-4 h-auto"})}),t.jsxs(r,{placement:"bottom-end",size:"sm",children:[t.jsx(c,{onClick:()=>$e(s,l),children:e("common.edit")}),t.jsx(c,{onClick:()=>(async s=>{if(window.confirm(e("setting.sso-section.confirm-delete",{name:s.title}))){try{await ie.deleteIdentityProvider({name:s.name})}catch(t){console.error(t),L.error(t.details)}await l()}})(s),children:e("common.delete")})]})]})})]},s.name))),0===s.length&&t.jsx("div",{className:"w-full mt-2 text-sm dark:border-zinc-700 opacity-60 flex flex-row items-center justify-between",children:t.jsx("p",{className:"",children:e("setting.sso-section.no-sso-found")})}),t.jsxs("div",{className:"w-full mt-4",children:[t.jsxs("p",{className:"text-sm",children:[e("common.learn-more"),":"]}),t.jsx(j,{component:"ul",marker:"disc",size:"sm",children:t.jsx(y,{children:t.jsx(C,{className:"text-sm text-blue-600 hover:underline",to:"https://www.usememos.com/docs/advanced-settings/sso",target:"_blank",children:e("setting.sso-section.single-sign-on")})})})]})]})},Be=({text:e,icon:s,isSelected:a,onClick:l})=>t.jsxs("div",{onClick:l,className:"w-auto max-w-full px-3 leading-8 flex flex-row justify-start items-center cursor-pointer rounded-lg select-none hover:opacity-80 "+(a?"bg-zinc-100 shadow dark:bg-zinc-900":""),children:[t.jsx(s,{className:"w-4 h-auto mr-2 opacity-80 shrink-0"}),t.jsx("span",{className:"truncate",children:e})]}),Ve=()=>{const e=M(),[s,i]=b.useState(ne.fromPartial(H.getWorkspaceSettingByKey(B.STORAGE)?.storageSetting||{})),n=b.useMemo((()=>{if(s.uploadSizeLimitMb<=0)return!1;const e=ne.fromPartial(H.getWorkspaceSettingByKey(B.STORAGE)?.storageSetting||{});if(s.storageType===re.LOCAL){if(0===s.filepathTemplate.length)return!1}else if(s.storageType===re.S3&&(0===s.s3Config?.accessKeyId.length||0===s.s3Config?.accessKeySecret.length||0===s.s3Config?.endpoint.length||0===s.s3Config?.region.length||0===s.s3Config?.bucket.length))return!1;return!v(e,s)}),[s,H.state]),r=async e=>{const t={...s,s3Config:ce.fromPartial({...s.s3Config,...e})};i(t)};return t.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[t.jsx("div",{className:"font-medium text-gray-700 dark:text-gray-500",children:e("setting.storage-section.current-storage")}),t.jsxs(a,{orientation:"horizontal",className:"w-full",value:s.storageType,onChange:e=>{(async e=>{const t={...s,storageType:e};i(t)})(e.target.value)},children:[t.jsx(l,{value:re.DATABASE,label:e("setting.storage-section.type-database")}),t.jsx(l,{value:re.LOCAL,label:e("setting.storage-section.type-local")}),t.jsx(l,{value:re.S3,label:"S3"})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsxs("div",{className:"flex flex-row items-center",children:[t.jsx("span",{className:"text-gray-700 dark:text-gray-500 mr-1",children:e("setting.system-section.max-upload-size")}),t.jsx(h,{title:e("setting.system-section.max-upload-size-hint"),placement:"top",children:t.jsx(je,{className:"w-4 h-auto"})})]}),t.jsx(E,{className:"w-16 font-mono",value:s.uploadSizeLimitMb,onChange:async e=>{let t=parseInt(e.target.value);Number.isNaN(t)&&(t=0);const a={...s,uploadSizeLimitMb:t};i(a)}})]}),s.storageType!==re.DATABASE&&t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{className:"text-gray-700 dark:text-gray-500 mr-1",children:e("setting.storage-section.filepath-template")}),t.jsx(E,{value:s.filepathTemplate,placeholder:"assets/{timestamp}_{filename}",onChange:async e=>{const t={...s,filepathTemplate:e.target.value};i(t)}})]}),s.storageType===re.S3&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{className:"text-gray-700 dark:text-gray-500 mr-1",children:"Access key id"}),t.jsx(E,{value:s.s3Config?.accessKeyId,placeholder:"",onChange:async e=>{r({accessKeyId:e.target.value})}})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{className:"text-gray-700 dark:text-gray-500 mr-1",children:"Access key secret"}),t.jsx(E,{value:s.s3Config?.accessKeySecret,placeholder:"",onChange:async e=>{r({accessKeySecret:e.target.value})}})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{className:"text-gray-700 dark:text-gray-500 mr-1",children:"Endpoint"}),t.jsx(E,{value:s.s3Config?.endpoint,placeholder:"",onChange:async e=>{r({endpoint:e.target.value})}})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{className:"text-gray-700 dark:text-gray-500 mr-1",children:"Region"}),t.jsx(E,{value:s.s3Config?.region,placeholder:"",onChange:async e=>{r({region:e.target.value})}})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{className:"text-gray-700 dark:text-gray-500 mr-1",children:"Bucket"}),t.jsx(E,{value:s.s3Config?.bucket,placeholder:"",onChange:async e=>{r({bucket:e.target.value})}})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{className:"text-gray-700 dark:text-gray-500 mr-1",children:"Use Path Style"}),t.jsx(o,{checked:s.s3Config?.usePathStyle,onChange:e=>{r({usePathStyle:e.target.checked})}})]})]}),t.jsx("div",{children:t.jsx(T,{color:"primary",disabled:!n,onClick:async()=>{await H.upsertWorkspaceSetting({name:`${_}${B.STORAGE}`,storageSetting:s}),L.success("Updated")},children:e("common.save")})}),t.jsx(f,{className:"!my-2"}),t.jsxs("div",{className:"w-full mt-4",children:[t.jsxs("p",{className:"text-sm",children:[e("common.learn-more"),":"]}),t.jsxs(j,{component:"ul",marker:"disc",size:"sm",children:[t.jsx(y,{children:t.jsx(C,{className:"text-sm text-blue-600 hover:underline",to:"https://www.usememos.com/docs/advanced-settings/local-storage",target:"_blank",children:"Docs - Local storage"})}),t.jsx(y,{children:t.jsx(C,{className:"text-sm text-blue-600 hover:underline",to:"https://www.usememos.com/blog/choosing-a-storage-for-your-resource",target:"_blank",children:"Choosing a Storage for Your Resource: Database, S3 or Local Storage?"})})]})]})]})},Ge=({destroy:e})=>{const s=M(),a=H.state.generalSetting,[l,i]=b.useState(oe.fromPartial(a.customProfile||{})),n=()=>{e()},r=e=>{i((s=>({...s,...e})))};return t.jsxs("div",{className:"max-w-full shadow flex flex-col justify-start items-start bg-white dark:bg-zinc-800 dark:text-gray-300 p-4 rounded-lg",children:[t.jsxs("div",{className:"flex flex-row justify-between items-center mb-4 gap-2 w-full",children:[t.jsx("p",{className:"title-text",children:s("setting.system-section.customize-server.title")}),t.jsx(T,{size:"sm",variant:"plain",onClick:n,children:t.jsx(A,{className:"w-5 h-auto"})})]}),t.jsxs("div",{className:"flex flex-col justify-start items-start min-w-[16rem]",children:[t.jsx("p",{className:"text-sm mb-1",children:s("setting.system-section.server-name")}),t.jsx(E,{className:"w-full",type:"text",value:l.title,onChange:e=>{r({title:e.target.value})}}),t.jsx("p",{className:"text-sm mb-1 mt-2",children:s("setting.system-section.customize-server.icon-url")}),t.jsx(E,{className:"w-full",type:"text",value:l.logoUrl,onChange:e=>{r({logoUrl:e.target.value})}}),t.jsx("p",{className:"text-sm mb-1 mt-2",children:s("setting.system-section.customize-server.description")}),t.jsx(x,{className:"w-full",minRows:"2",maxRows:"4",value:l.description,onChange:e=>{r({description:e.target.value})}}),t.jsx("p",{className:"text-sm mb-1 mt-2",children:s("setting.system-section.customize-server.locale")}),t.jsx(fe,{className:"!w-full",value:l.locale,onChange:e=>{r({locale:e})}}),t.jsx("p",{className:"text-sm mb-1 mt-2",children:s("setting.system-section.customize-server.appearance")}),t.jsx(ge,{className:"!w-full",value:l.appearance,onChange:e=>{r({appearance:e})}}),t.jsxs("div",{className:"mt-4 w-full flex flex-row justify-between items-center space-x-2",children:[t.jsx("div",{className:"flex flex-row justify-start items-center",children:t.jsx(T,{variant:"outlined",onClick:()=>{r({title:"Memos",logoUrl:"/logo.webp",description:"",locale:"en",appearance:"system"})},children:s("common.restore")})}),t.jsxs("div",{className:"flex flex-row justify-end items-center gap-2",children:[t.jsx(T,{variant:"plain",onClick:n,children:s("common.cancel")}),t.jsx(T,{color:"primary",onClick:async()=>{if(""!==l.title){try{await H.upsertWorkspaceSetting({name:`${_}${B.GENERAL}`,generalSetting:{...a,customProfile:l}})}catch(t){return void console.error(t)}L.success(s("message.update-succeed")),e()}else L.error("Title cannot be empty.")},children:s("common.save")})]})]})]})]})},Ke=()=>{const e=M(),s=de.fromPartial(H.getWorkspaceSettingByKey(B.GENERAL)?.generalSetting||{}),[a,l]=b.useState(s),[i,n]=b.useState([]);b.useEffect((()=>{l(s)}),[H.getWorkspaceSettingByKey(B.GENERAL)]);const r=e=>{l(de.fromPartial({...a,...e}))};b.useEffect((()=>{c()}),[]);const c=async()=>{const{identityProviders:e}=await ie.listIdentityProviders({});n(e)};return t.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[t.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-500",children:e("common.basic")}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsxs("div",{children:[e("setting.system-section.server-name"),":"," ",t.jsx("span",{className:"font-mono font-bold",children:a.customProfile?.title||"Memos"})]}),t.jsx(T,{variant:"outlined",onClick:()=>{z({className:"update-customized-profile-dialog",dialogName:"update-customized-profile-dialog"},Ge)},children:e("common.edit")})]}),t.jsx(f,{}),t.jsx("p",{className:"font-medium text-gray-700 dark:text-gray-500",children:e("setting.system-section.title")}),t.jsx("div",{className:"w-full flex flex-row justify-between items-center",children:t.jsx("span",{children:e("setting.system-section.additional-style")})}),t.jsx(x,{className:"w-full",sx:{fontFamily:"monospace",fontSize:"14px"},minRows:2,maxRows:4,placeholder:e("setting.system-section.additional-style-placeholder"),value:a.additionalStyle,onChange:e=>r({additionalStyle:e.target.value})}),t.jsx("div",{className:"w-full flex flex-row justify-between items-center",children:t.jsx("span",{children:e("setting.system-section.additional-script")})}),t.jsx(x,{className:"w-full",color:"neutral",sx:{fontFamily:"monospace",fontSize:"14px"},minRows:2,maxRows:4,placeholder:e("setting.system-section.additional-script-placeholder"),value:a.additionalScript,onChange:e=>r({additionalScript:e.target.value})}),t.jsx("div",{className:"w-full",children:t.jsxs(C,{className:"text-gray-500 text-sm flex flex-row justify-start items-center hover:underline hover:text-blue-600",to:"https://usememos.com/docs/advanced-settings/custom-style-and-script",target:"_blank",children:[e("common.learn-more"),t.jsx(pe,{className:"inline w-4 h-auto ml-1"})]})}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{children:e("setting.workspace-section.disallow-user-registration")}),t.jsx(o,{disabled:"demo"===H.state.profile.mode,checked:a.disallowUserRegistration,onChange:e=>r({disallowUserRegistration:e.target.checked})})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{children:e("setting.workspace-section.disallow-password-auth")}),t.jsx(o,{disabled:"demo"===H.state.profile.mode||0===i.length,checked:a.disallowPasswordAuth,onChange:e=>r({disallowPasswordAuth:e.target.checked})})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{children:e("setting.workspace-section.disallow-change-username")}),t.jsx(o,{checked:a.disallowChangeUsername,onChange:e=>r({disallowChangeUsername:e.target.checked})})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{children:e("setting.workspace-section.disallow-change-nickname")}),t.jsx(o,{checked:a.disallowChangeNickname,onChange:e=>r({disallowChangeNickname:e.target.checked})})]}),t.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[t.jsx("span",{className:"truncate",children:e("setting.workspace-section.week-start-day")}),t.jsxs(u,{className:"!min-w-fit",value:a.weekStartDayOffset,onChange:(e,s)=>{r({weekStartDayOffset:s||0})},children:[t.jsx(p,{value:-1,children:e("setting.workspace-section.saturday")}),t.jsx(p,{value:0,children:e("setting.workspace-section.sunday")}),t.jsx(p,{value:1,children:e("setting.workspace-section.monday")})]})]}),t.jsx("div",{className:"mt-2 w-full flex justify-end",children:t.jsx(T,{color:"primary",disabled:v(a,s),onClick:async()=>{try{await H.upsertWorkspaceSetting({name:`${_}${B.GENERAL}`,generalSetting:a})}catch(s){return L.error(s.details),void console.error(s)}L.success(e("message.update-succeed"))},children:e("common.save")})})]})},qe=["my-account","preference"],Ye=["member","system","memo-related","storage","sso"],Ze={"my-account":be,preference:we,member:ue,system:he,"memo-related":ke,storage:ve,sso:Ne};e("default",k((()=>{const e=M(),{md:s}=me(),a=S(),l=R(),[i,n]=b.useState({selectedSection:"my-account"}),r=l.role===W.HOST,c=b.useMemo((()=>{let e=[...qe];return r&&(e=e.concat(Ye)),e}),[r]);b.useEffect((()=>{let e=a.hash.slice(1);[...qe,...Ye].includes(e)||(e="my-account"),n({selectedSection:e})}),[a.hash]),b.useEffect((()=>{r&&(async()=>{[B.MEMO_RELATED,B.STORAGE].forEach((async e=>{await H.fetchWorkspaceSetting(e)}))})()}),[r]);const o=b.useCallback((e=>{window.location.hash=e}),[]);return t.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-start sm:pt-3 md:pt-6 pb-8",children:[!s&&t.jsx(xe,{}),t.jsx("div",{className:"w-full px-4 sm:px-6",children:t.jsxs("div",{className:"w-full shadow flex flex-row justify-start items-start px-4 py-3 rounded-xl bg-white dark:bg-zinc-800 text-gray-600 dark:text-gray-400",children:[t.jsxs("div",{className:"hidden sm:flex flex-col justify-start items-start w-40 h-auto shrink-0 py-2",children:[t.jsx("span",{className:"text-sm mt-0.5 pl-3 font-mono select-none text-gray-400 dark:text-gray-500",children:e("common.basic")}),t.jsx("div",{className:"w-full flex flex-col justify-start items-start mt-1",children:qe.map((s=>t.jsx(Be,{text:e(`setting.${s}`),icon:Ze[s],isSelected:i.selectedSection===s,onClick:()=>o(s)},s)))}),r?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-sm mt-4 pl-3 font-mono select-none text-gray-400 dark:text-gray-500",children:e("common.admin")}),t.jsxs("div",{className:"w-full flex flex-col justify-start items-start mt-1",children:[Ye.map((s=>t.jsx(Be,{text:e(`setting.${s}`),icon:Ze[s],isSelected:i.selectedSection===s,onClick:()=>o(s)},s))),t.jsxs("span",{className:"px-3 mt-2 opacity-70 text-sm",children:[e("setting.version"),": v",H.state.profile.version]})]})]}):null]}),t.jsxs("div",{className:"w-full grow sm:pl-4 overflow-x-auto",children:[t.jsx("div",{className:"w-auto inline-block my-2 sm:hidden",children:t.jsx(u,{value:i.selectedSection,onChange:(e,s)=>o(s),children:c.map((s=>t.jsx(p,{value:s,children:e(`setting.${s}`)},s)))})}),"my-account"===i.selectedSection?t.jsx(Re,{}):"preference"===i.selectedSection?t.jsx(Oe,{}):"member"===i.selectedSection?t.jsx(Ue,{}):"system"===i.selectedSection?t.jsx(Ke,{}):"memo-related"===i.selectedSection?t.jsx(ze,{}):"storage"===i.selectedSection?t.jsx(Ve,{}):"sso"===i.selectedSection?t.jsx(_e,{}):null]})]})})]})})))}}}));
